function init(){"devicePixelRatio"in window&&(pie.dpi=window.devicePixelRatio,pie.dpi>1&&(pie.maleHeadUrl="img/maleHead@2.jpg",pie.femaleHeadUrl="img/femaleHead@2.jpg",pie.smallMaleHeadUrl="img/smallMaleHead@2.jpg",pie.smallFemaleHeadUrl="img/smallFemaleHead@2.jpg")),typeof cordova=="undefined"?(pie.serverBase="http://"+document.domain,jQuery("#uploadPhotoForm").css("display","block"),window.localStorage.pieFirst?pie.init():(pie.resize(),pie.showPage("pieGuidePage"))):jQuery("#uploadPhotoSelect").css("display","block");var e=document.createElement("canvas"),t=e.toDataURL("image/png");pie.canvasExist=t.indexOf("data:image/png")==0,window.addEventListener("message",function(e){var t=e.data;if(t=="getHeight"){for(var n=0;n<window.frames.length;n++)window.frames[n].name=="pieFamilyFrame"&&window.frames[n].postMessage(window.innerHeight-44,"*");return}if(t.result.status!="success"){pie.remind("登录碰到未知错误,请联系管理员");return}pie.user.exist=!0;switch(t.result.data.type){case"weibo":pie.useWeibo=!0;break;case"renren":pie.useRenren=!0;break;case"qq":pie.useQQ=!0}pie.user.data=t.result.data,pie.jPush.bind(),pie.user.getInfo(0);var r={data:pie.user.data,info:null,curMate:null,matchReply:null,tips:null,mateInfo:null,infoFinished:!1,talkRecord:[],messageSended:!0,mateAnswerIndex:null,nextMessageIndex:0,userBigPhotos:[],userSmallPhotos:[],menuAvatar:null,userHomeAvatar:null,userInfoAvatar:null,userTalkAvatar:null,mateTalkAvatar:null,mateHomeAvatar:null,expectations:null,seeLifeReport:null,seeLoveReport:null,communicationReport:null,personalityReport:null};if(pie.pieMoment==undefined)pie.pieMoment={users:[r],userId:0};else{var i=!1;for(var n=0;n<pie.pieMoment.users.length;n++)if(pie.pieMoment.users[n].data.access_token==t.result.data.access_token){pie.pieMoment.userId=n,pie.pieMoment.users[n].data=pie.user.data,i=!0;break}i?pie.getLocalData():(pie.pieMoment.users.push(r),pie.pieMoment.userId=pie.pieMoment.users.length-1)}pie.backup(),pie.showPage("pieMatchIndexPage"),pie.loginMedia.play()},!1),document.addEventListener("deviceready",function(){pie.connectionType=navigator.connection.type,pie.connectionType=="none"?pie.online=!1:pie.online=!0,pie.platformModel=device.model,pie.platform=device.platform.toLowerCase(),pie.platformVersion=parseInt(device.version),pie.platform=="android"?(pie.loginMedia=new Media("/android_asset/www/media/login.mp3"),pie.newMessageMedia=new Media("/android_asset/www/media/newMessage.mp3"),pie.platformVersion<4&&(pie.isOld=!0)):(pie.loginMedia=new Media("/media/login.mp3"),pie.newMessageMedia=new Media("/media/newMessage.mp3")),navigator.geolocation.getCurrentPosition(function(e){pie.gps=e.coords,pie.user.submitGPS()},function(e){}),document.addEventListener("backbutton",function(){pie.page[pie.curPageId].backPageId?pie.pageBack():pie.confirm("确认要退出么?",function(){navigator.app.exitApp()})},!1),document.addEventListener("menubutton",function(){if(!pie.user.exist)return;pie.leftMenu.display||pie.rightMenu.display?pie.expand():pie.reduceRight()},!1),document.addEventListener("pause",function(){pie.atBackstage=!0},!1),document.addEventListener("resume",function(){pie.atBackstage=!1,pie.notifyNum>0&&(pie.notifyNum=0,pie.tcp.clearUnreadMessage(),pie.showPage("mateTalkPage")),pie.platform=="ios"&&pie.localNotification.clear()},!1),window.localStorage.pieFirst?pie.init():(pie.resize(),pie.showPage("pieGuidePage"))},!1)}var pie={id:"pie",serverBase:"http://www.piemoment.com",gameBase:"http://piemoment.com:3000",maleHeadUrl:"img/maleHead.jpg",femaleHeadUrl:"img/femaleHead.jpg",smallMaleHeadUrl:"img/smallMaleHead.jpg",smallFemaleHeadUrl:"img/smallFemaleHead.jpg",useRenren:!1,useWeibo:!1,useQQ:!1,dpi:1,refreshTime:12,originHeight:null,originWidth:null,headerHeight:44,maxWidth:400,height:null,width:null,pieMoment:null,curPageId:null,loginMedia:null,confirmShow:!1,loadingShow:!1,loading:null,matchSuccessMedia:null,newMessageMedia:null,remindDisapear:null,gps:null,soundOn:!0,onInput:!1,curInputId:null,swipePhoto:!1,atBackstage:!1,notifyNum:0,curLoginAccount:null,curLoginPassword:null,unreadMessageNum:0,needCheckLeave:!0,refreshReady:!1,talkScrollArea:null,platform:"web",platformModel:null,platformVersion:null,isOld:!1,canvasExist:null,online:!1,studyStart:!1,femaleTips:["一颗心与另一颗心到底有多远的距离，是咫尺 ?是天涯 ?而我会默默地等待，等待你和我一个浪漫的开始。","人生有太多等待，我们不得不学会等待，还要学会习惯于不尽如人意的等待。","认识了你，是你让我学会了等待，虽然等待有时会换来失望，但是我还是选择了等待！你若不离，我定不弃！","缘起缘灭，缘浓缘淡，不是我们能够控制的，我们能做到的，是因缘际会的时候，好好珍惜那短暂的时光。","我要你知道，这世界上有一个人是永远等着你的，不管是在什么时候，不管你是在什么地方，反正你知道，总有这样一个人。","似乎习惯了等待， 单纯的以为等待就会到来。   但却在等待中错过了， 那些可以幸福的幸福。   在失去时后悔， 为什么没有抓住。","在什么都不确定的年代，我们总是爱得太早，放弃的太快，轻易付出承诺，又不想等待结果。","成熟的爱情，敬意、忠心并不轻易表现出来，它的声音是低的，它是谦逊的、退让的、潜伏的，等待了又等待。","等待你的love是一种勇气，因为我看不到未来，但是等你对我来说是一种幸福，是一种依赖！！！","Like or pass， it‘s your choice.","Pie Moment a day, keep single away.","It is your Pie Moment.","爱情，没有捷径。不过我们有Piemoment","轻轻一点遇到希望中ta","Like ta, ta 不知道你的选择！","没想到ta也点了like.","每天新缘分，自由派瞬间","派瞬间，爱永恒","男人就像食堂里的菜，不好吃，但来晚了就没有了","爱情没有对错只有选择","为什么不试试like，反正他也不知道。","Pie Moment, Love Forever."],maleTips:["一颗心与另一颗心到底有多远的距离，是咫尺 ?是天涯 ?而我会默默地等待，等待你和我一个浪漫的开始。","人生有太多等待，我们不得不学会等待，还要学会习惯于不尽如人意的等待。","认识了你，是你让我学会了等待，虽然等待有时会换来失望，但是我还是选择了等待！你若不离，我定不弃！","缘起缘灭，缘浓缘淡，不是我们能够控制的，我们能做到的，是因缘际会的时候，好好珍惜那短暂的时光。","我要你知道，这世界上有一个人是永远等着你的，不管是在什么时候，不管你是在什么地方，反正你知道，总有这样一个人。","似乎习惯了等待， 单纯的以为等待就会到来。   但却在等待中错过了， 那些可以幸福的幸福。   在失去时后悔， 为什么没有抓住。","在什么都不确定的年代，我们总是爱得太早，放弃的太快，轻易付出承诺，又不想等待结果。","成熟的爱情，敬意、忠心并不轻易表现出来，它的声音是低的，它是谦逊的、退让的、潜伏的，等待了又等待。","等待你的love是一种勇气，因为我看不到未来，但是等你对我来说是一种幸福，是一种依赖！！！","Like or pass， it‘s your choice.","Pie Moment a day, keep single away.","It is your Pie Moment.","爱情，没有捷径。不过我们有Piemoment","轻轻一点遇到希望中ta","Like ta, ta 不知道你的选择！","没想到ta也点了like.","每天新缘分，自由派瞬间","派瞬间，爱永恒","男人就像食堂里的菜，不好吃，但来晚了就没有了","爱情没有对错只有选择","为什么不试试like，反正他也不知道。","Pie Moment, Love Forever."],connectionType:null,connectionText:{unknown:"未知",ethernet:"以太网",wifi:"WiFi","2g":"2G蜂窝网络","3g":"3G蜂窝网络","4f":"4G蜂窝网络",cellular:"蜂窝网络",none:"无连接"},messageStatus:{inMessage:0,onSend:1,sendSuccess:2,sendFailed:3,deleted:4,received:5,read:6},degreeList:["专科","本科","硕士","博士"],occupationList:["学习","工作","待业"],domainList:[["计算机","电子信息","中文","外文","经济学","金融学","管理","市场营销","法学","教育","社会学","历史","哲学","艺术","图书馆","情报档案","政治","数学","统计","物理","化学","生物","食品","医学","环境","地理","建筑","测绘","电气","机械","其他"],["计算机/网络","科研/教育","公关/广告","传媒/出版","营销/市场/策划","金融/证券/保险","房地产/建筑业","装饰/装潢","邮电通信","电子/电器","美容/形体","警察/其它","食品业","消费品业","制药业","商业/贸易","咨询业","汽车","航天","社会服务","旅游","餐饮","健康/医疗","交通运输","文化/娱乐/体育","政府机关","法律/司法","制造业","农林牧渔业","其他"],["其他"]],tcp:{handle:null,dumped:!1,checkSend:null,lastTime:null,init:function(){this.handle=io.connect(pie.gameBase);var e=this.handle;e.on("connected",function(){e.emit("login",{puid:pie.user.data.puid,sex:pie.user.info.sex,platform:pie.platform,model:pie.platformModel,version:pie.platformVersion}),e.on("dump",function(){if(pie.tcp.dumped)return;pie.tcp.dumped=!0,alert("你的账号已在别处登录"),pie.user.logout(0)}),e.on("pieTips",function(e){var t=e.tips.length;for(var n=0;n<t;n++)pie.user.tips.push(e.tips[n])}),e.on("disconnect",function(){if(pie.tcp.dumped)return;pie.tcp.handle=null,pie.tcp.init()}),e.on("pieMessage",function(t){if(pie.tcp.dumped||!pie.mate.info)return;var n=t.content;if(t.from==pie.mate.info.puid){for(var r=pie.user.talkRecord.length-1,i=0;r>=0;r--,i++){if(pie.user.talkRecord[r].mid==t.mid)return;if(i>10)break}for(var r=pie.user.talkRecord.length-1;r>=0;r--)if(pie.user.talkRecord[r].status!=pie.messageStatus.inMessage){if(pie.user.talkRecord[r].status==pie.messageStatus.read)break;for(var s=r;s>=0;s--)if(pie.user.talkRecord[s].status==pie.messageStatus.sendSuccess||pie.user.talkRecord[s].status==pie.messageStatus.received)jQuery("#"+s+"userTalkBlock .messageStatus").html("已读"),pie.user.talkRecord[s].status=pie.messageStatus.read;break}pie.user.talkRecord.push({mid:t.mid,from:pie.mate.info.puid,to:pie.user.data.puid,status:pie.messageStatus.inMessage,content:n.content,contentType:n.contentType,time:n.time}),e.emit("messageReceived",{targetId:t.from,mid:t.mid});var o=n.content;pie.user.mateTalkAvatar||(pie.user.mateTalkAvatar=pie.serverBase+"/asset/"+pie.mate.info.avatar.uri+"/40/40/smart/inline"),pie.backup();var u=pie.tcp.judgeTime(n.time),a='<div class="mateTalkBlock" id="'+t.mid+'mateTalkBlock"><table><tbody><tr><td valign="top" width="15%"><div class="mateTalkHead" style="background-image:url('+pie.user.mateTalkAvatar+')"></div></td><td valign="top"><div class="mateTalkContent">'+o+'</div><span class="messageTime">'+u+"</span></td></tr></tbody></table></div>";jQuery("#mateTalkPage .scrollArea").append(a),pie.talkScrollArea.refresh();var f=document.getElementById(t.mid+"mateTalkBlock");pie.talkScrollArea.scrollToElement(f,100),pie.atBackstage?(pie.newMessageMedia.play(),pie.notifyNum++,pie.notifyNum>1?pie.localNotification.add(pie.mate.info.nickname,"发来"+pie.notifyNum+"条新消息"):pie.localNotification.add(pie.mate.info.nickname,n.content)):pie.curPageId!="mateTalkPage"?pie.tcp.newUnreadMessage():e.emit("messageRead",{mid:t.mid,targetId:pie.mate.info.puid})}}),e.on("messageSendSuccess",function(e){if(pie.user.messageSended)return;clearTimeout(pie.tcp.checkSend),jQuery("#"+pie.user.nextMessageIndex+"userTalkBlock .userTalkContent").data("id",-1),jQuery("#"+pie.user.nextMessageIndex+"userTalkBlock .messageStatus").html(""),jQuery("#"+pie.user.nextMessageIndex+"userTalkBlock .userTalkContent").css("background-color","#A5CFD3"),pie.user.messageSended=!0,pie.user.talkRecord[pie.user.nextMessageIndex].status=pie.messageStatus.sendSuccess,pie.user.talkRecord[pie.user.nextMessageIndex].mid=e.mid,pie.user.nextMessageIndex++,pie.tcp.emitNextMessage()}),e.on("messageReceived",function(e){for(var t=pie.user.talkRecord.length-1;t>=0;t--)if(pie.user.talkRecord[t].mid==e.mid&&pie.user.talkRecord[t].status==pie.messageStatus.sendSuccess){jQuery("#"+t+"userTalkBlock .messageStatus").html("送达"),pie.user.talkRecord[t].status=pie.messageStatus.received;break}}),e.on("messageRead",function(e){for(var t=pie.user.talkRecord.length-1;t>=0;t--)if(pie.user.talkRecord[t].mid==e.mid){for(var n=t;n>=0;n--)if(pie.user.talkRecord[n].status==pie.messageStatus.sendSuccess||pie.user.talkRecord[n].status==pie.messageStatus.received)jQuery("#"+n+"userTalkBlock .messageStatus").html("已读"),pie.user.talkRecord[n].status=pie.messageStatus.read;break}}),e.on("putQuestionSuccess",function(e){pie.hideLoading(),pie.remind("提交问题成功,请等待审核结果"),jQuery("#userInputPage").css("-webkit-transform","translate3d(0,0,0)"),setTimeout(function(){pie.reduceLeft()},100)})})},judgeTime:function(e){var t=e.split(" "),n=t[0].split("-"),r=t[1].split(":"),i=new Date,s=null;return n[0]<i.getFullYear()||n[1]<i.getMonth()+1?s=e:n[2]<i.getDate()?s=n[1]+"-"+n[2]+" "+r.join(":"):s=r.join(":"),s},sendMessage:function(e){if(pie.tcp.dumped)return!1;var e=jQuery("#talkInput").val();if(e=="")return!1;jQuery("#talkInput").val(""),jQuery("#talkInput").css("height",30);var t;"avatar"in pie.user.info?pie.user.userTalkAvatar?t=pie.user.userTalkAvatar:(t=pie.serverBase+"/asset/"+pie.user.info.avatar.uri+"/40/40/smart/inline",pie.user.userTalkAvatar=t):pie.user.info.sex==1?t=pie.maleHeadUrl:t=pie.femaleHeadUrl;var n="发送中";pie.mate.exist||(n="已读");var r='<div class="userTalkBlock" id="'+pie.user.talkRecord.length+'userTalkBlock"><table><tbody><tr><td valign="bottom" text-align="right" width="85%"><span class="messageStatus">'+n+'</span><div class="userTalkContent">'+e+'</div></td><td valign="top"><div class="userTalkHead" style="background-image:url('+t+')"></div></td></tr></tabody></table></div>';jQuery("#mateTalkPage .scrollArea").append(r),pie.talkScrollArea.refresh();var i=document.getElementById(pie.user.talkRecord.length+"userTalkBlock");return pie.talkScrollArea.scrollToElement(i,100),pie.mate.exist?(pie.user.talkRecord.push({mid:-1,from:pie.user.data.puid,to:pie.mate.info.puid,status:pie.messageStatus.onSend,content:e,contentType:0,time:pie.messageTime()}),this.emitNextMessage()):(pie.user.talkRecord.push({mid:-1,from:pie.user.data.puid,to:pie.mate.info.puid,status:pie.messageStatus.read,content:e,contentType:0,time:pie.messageTime()}),pie.backup(),pie.npc.talk(e)),!1},emitNextMessage:function(){var e=pie.user.nextMessageIndex,t=pie.user.talkRecord;while(e<t.length&&(t[e].from!=pie.user.data.puid||t[e].status==pie.messageStatus.deleted))e++;pie.user.nextMessageIndex=e,pie.backup();if(e>=t.length)return;pie.user.messageSended&&(pie.user.messageSended=!1,this.handle.emit("pieTalk",{targetId:pie.mate.info.puid,content:t[e].content,contentType:t[e].contentType}),this.checkSend=setTimeout(function(){pie.tcp.emitFailed()},15e3),pie.backup())},emitFailed:function(){jQuery("#"+pie.user.nextMessageIndex+"userTalkBlock .messageStatus").html("发送失败"),jQuery("#"+pie.user.nextMessageIndex+"userTalkBlock .userTalkContent").data("id",pie.user.nextMessageIndex),jQuery("#"+pie.user.nextMessageIndex+"userTalkBlock .userTalkContent").css("background-color","#555"),Quo(".userTalkContent").unbind("hold"),Quo(".userTalkContent").bind("hold",function(){var e=jQuery(this).data("id");e>=0&&pie.tcp.showMessageControl(e)}),pie.user.messageSended=!0,pie.user.talkRecord[pie.user.nextMessageIndex].status=pie.messageStatus.sendFailed,pie.user.nextMessageIndex++,pie.tcp.emitNextMessage()},showMessageControl:function(e){pie.showShadow(),jQuery("#messageControlBox").css("top",Math.floor((pie.height-101)/2)),jQuery("#messageControlBox").css("display","block"),Quo("#resendMessage").unbind("tap"),Quo("#resendMessage").bind("tap",function(){pie.user.nextMessageIndex=e,pie.user.talkRecord[pie.user.nextMessageIndex].status=pie.messageStatus.onSend,pie.hideShadow(),jQuery("#messageControlBox").css("display","none"),jQuery("#"+pie.user.nextMessageIndex+"userTalkBlock .messageStatus").html("重发中"),pie.tcp.emitNextMessage()}),Quo("#deleteMessage").unbind("tap"),Quo("#deleteMessage").bind("tap",function(){pie.user.talkRecord[e].status=pie.messageStatus.deleted,pie.backup(),pie.hideShadow(),jQuery("#messageControlBox").css("display","none"),jQuery("#"+e+"userTalkBlock").css("display","none"),pie.talkScrollArea.refresh()}),Quo("#pieShadow").unbind("tap"),setTimeout(function(){Quo("#pieShadow").bind("tap",function(){jQuery("#messageControlBox").css("display","none"),pie.hideShadow()})},500)},newUnreadMessage:function(){if(!pie.mate.exist)return;pie.unreadMessageNum++,pie.unreadMessageNum>9?jQuery(".unreadMessageNum").html("9+"):jQuery(".unreadMessageNum").html(pie.unreadMessageNum),jQuery(".unreadMessageNum").css("display","block"),pie.newMessageMedia.play()},clearUnreadMessage:function(){pie.unreadMessageNum=0,jQuery(".unreadMessageNum").css("display","none");if(!pie.mate.exist)return;for(var e=pie.user.talkRecord.length-1;e>=0;e--)if(pie.user.talkRecord[e].status==pie.messageStatus.inMessage){this.handle.emit("messageRead",{mid:pie.user.talkRecord[e].mid,targetId:pie.mate.info.puid});break}},askQuestion:function(e){this.handle.emit("askQuestion",{title:e,type:1})}},select:{scroll:{},range:{},value:{},dayArray:[31,28,31,30,31,30,31,31,30,31,30,31],liHeight:40,rTime:1e3,init:function(e){if(e in this.scroll){this.scroll[e].refresh();var t=this.getValue(e),n=this.getValueIndex(e,t),r=n*this.liHeight;this.scroll[e].scrollTo(0,-r,0,!1),this.change(e);return}var i="";this.range[e]=[];var s=0;switch(e){case"userInfoHeightInput":for(var o=100;o<=230;o++)this.range[e].push(o),i+="<li>"+o+"cm</li>";e in this.value||this.setValue(e,"170");break;case"userInfoWeightInput":for(var o=30;o<=200;o++)this.range[e].push(o),i+="<li>"+o+"kg</li>";e in this.value||this.setValue(e,"60");break;case"userInfoBirthdayYearInput":for(var o=1960;o<=2e3;o++)this.range[e].push(o),i+="<li>"+o+"年</li>";e in this.value||this.setValue(e,"1990");break;case"userInfoBirthdayMonthInput":for(var o=1;o<=12;o++)this.range[e].push(o),i+="<li>"+o+"月</li>";e in this.value||this.setValue(e,"1");break;case"userInfoBirthdayDayInput":var u=this.value.userInfoBirthdayMonthInput;for(var o=1;o<=this.dayArray[u-1];o++)this.range[e].push(o),i+="<li>"+o+"日</li>";e in this.value||this.setValue(e,"1");break;case"userInfoCurrentLocationProvinceInput":case"userInfoBirthPlaceProvinceInput":case"userExpectationIdealLocationProvinceInput":for(var a in pieLocation["中国"])this.range[e].push(a),i+="<li>"+a+"</li>";e in this.value||this.setValue(e,"北京市");break;case"userInfoCurrentLocationCityInput":var f="userInfoCurrentLocationProvinceInput",l=this.value[f],i="";for(var c in pieLocation["中国"][l])this.range[e].push(c),i+="<li>"+c+"</li>";e in this.value||this.setValue(e,"东城区");break;case"userInfoBirthPlaceCityInput":var f="userInfoBirthPlaceProvinceInput",l=this.value[f],i="";for(var c in pieLocation["中国"][l])this.range[e].push(c),i+="<li>"+c+"</li>";e in this.value||this.setValue(e,"东城区");break;case"userExpectationIdealLocationCityInput":var f="userExpectationIdealLocationProvinceInput",l=this.getValue(f);for(var c in pieLocation["中国"][l])this.range[e].push(c),i+="<li>"+c+"</li>";e in this.value||this.setValue(e,"东城区");break;case"schoolProvinceInput":for(var o=0;o<schoolList.length;o++)this.range[e].push(o),i+="<li>"+schoolList[o].name+"</li>";e in this.value||this.setValue(e,"0");break;case"userInfoSchoolInput":var s=this.value.schoolProvinceInput;for(var a in schoolList[s].school)this.range[e].push(schoolList[s].school[a].name),i+="<li>"+schoolList[s].school[a].name+"</li>";e in this.value||this.setValue(e,"北京大学");break;case"userInfoDegreeInput":var h=pie.degreeList.length;for(var o=0;o<h;o++)this.range[e].push(pie.degreeList[o]),i+="<li>"+pie.degreeList[o]+"</li>";e in this.value||this.setValue(e,"本科");break;case"userInfoOccupationInput":var h=pie.occupationList.length;for(var o=0;o<h;o++)this.range[e].push(o),i+="<li>"+pie.occupationList[o]+"</li>";e in this.value||this.setValue(e,"0");break;case"userInfoDomainInput":var s=this.getValue("userInfoOccupationInput"),p=pie.domainList[s];for(var o=0;o<p.length;o++)this.range[e].push(o),i+="<li>"+p[o]+"</li>";e in this.value||this.setValue(e,"计算机");break;case"userExpectationMinHeightInput":for(var o=100;o<=230;o++)this.range[e].push(o),i+="<li>"+o+"cm</li>";e in this.value||this.setValue(e,"150");break;case"userExpectationMaxHeightInput":var s=this.getValue("userExpectationMinHeightInput");for(var o=s;o<=230;o++)this.range[e].push(o),i+="<li>"+o+"cm</li>";e in this.value||this.setValue(e,"190");break;case"userExpectationMinAgeInput":for(var o=-30;o<=30;o++)this.range[e].push(o),o<0?i+="<li>小我"+ -1*o+"岁</li>":o==0?i+="<li>和我同岁</li>":o>0&&(i+="<li>大我"+o+"岁</li>");e in this.value||this.setValue(e,"-2");break;case"userExpectationMaxAgeInput":var s=this.getValue("userExpectationMinAgeInput");for(var o=s;o<=30;o++)this.range[e].push(o),o<0&&(i+="<li>小我"+ -1*o+"岁</li>"),o==0&&(i+="<li>和我同岁</li>"),o>0&&(i+="<li>大我"+o+"岁</li>");e in this.value||this.setValue(e,"3");break;case"userExpectationMinDegreeInput":var h=pie.degreeList.length;for(var o=0;o<h;o++)this.range[e].push(o),i+="<li>"+pie.degreeList[o]+"</li>";e in this.value||this.setValue(e,"1");break;case"userExpectationMaxDegreeInput":var s=this.getValue("userExpectationMinDegreeInput");for(var o=s;o<pie.degreeList.length;o++)this.range[e].push(o),i+="<li>"+pie.degreeList[o]+"</li>";e in this.value||this.setValue(e,"2");break;case"userExpectationLocationDistanceInput":var d=["同城","同省","同国","同星球"],h=d.length;for(var o=0;o<h;o++)this.range[e].push(d[o]),i+="<li>"+d[o]+"</li>";e in this.value||this.setValue(e,"同省")}jQuery("#"+e+" ul").html(i),this.scroll[e]=new iScroll(e,{useTransition:!0,hScroll:!1,scrollbarClass:"hidden",checkDOMChanges:!1,onScrollEnd:function(){var t=-1*this.y,n=this.wrapper.id,r=pie.select,i=Math.floor(t/r.liHeight),s=t-i*r.liHeight;if(s==0){var o=r.getValue(e),u=r.range[n][i];r.setValue(e,u),u!=o&&r.change(e);return}s>=r.liHeight/2?(i++,this.scrollTo(0,r.liHeight-s,500,!0)):this.scrollTo(0,-s,500,!0)}});var t=this.getValue(e),n=this.getValueIndex(e,t),r=n*this.liHeight;this.scroll[e].scrollTo(0,-r,0,!1)},setValue:function(e,t){this.value[e]=t},getValue:function(e){return this.value[e]},getValueIndex:function(e,t){var n=this.range[e].length;for(var r=n-1;r>=0;r--)if(this.range[e][r]==t)return r;return-1},change:function(e){switch(e){case"userInfoBirthdayYearInput":this.judgeLeapYear();break;case"userInfoBirthdayMonthInput":this.showDay();break;case"userInfoCurrentLocationProvinceInput":this.showCity("userInfoCurrentLocationCityInput",this.getValue(e));break;case"userInfoBirthPlaceProvinceInput":this.showCity("userInfoBirthPlaceCityInput",this.getValue(e));break;case"userExpectationIdealLocationProvinceInput":this.showCity("userExpectationIdealLocationCityInput",this.getValue(e));break;case"schoolProvinceInput":this.showSchool();break;case"userInfoOccupationInput":this.showDomain();break;case"userExpectationMinHeightInput":this.showMaxHeight();break;case"userExpectationMinAgeInput":this.showMaxAge();break;case"userExpectationMinDegreeInput":this.showMaxDegree()}},judgeLeapYear:function(){var e=this.value.userInfoBirthdayYearInput;e%4==0&&e%100!=0||e%400==0?this.dayArray[1]=29:this.dayArray[1]=28,this.change("userInfoBirthdayMonthInput")},showDay:function(){var e="userInfoBirthdayDayInput",t=this.getValue(e),n=this.getValueIndex(e,t),r="";this.range[e]=[];var i=this.value.userInfoBirthdayMonthInput;for(var s=1;s<=this.dayArray[i-1];s++)this.range[e].push(s),r+="<li>"+s+"日</li>";jQuery("#"+e+" ul").html(r),this.scroll[e].refresh();var o=this.getValueIndex(e,t);o>=0?(this.setValue(t),this.scroll[e].scrollTo(0,(o-n)*this.liHeight,this.rTime,!0)):(this.setValue(this.range[e][0]),this.scroll[e].scrollTo(0,-n*this.liHeight,this.rTime,!0))},showCity:function(e,t){var n=this.getValue(e),r=this.getValueIndex(e,n),i="";this.range[e]=[];for(var s in pieLocation["中国"])if(s==t){for(var o in pieLocation["中国"][s])this.range[e].push(o),i+="<li>"+o+"</li>";break}jQuery("#"+e+" ul").html(i),this.scroll[e].refresh();var u=this.getValueIndex(e,n);u>=0?(this.setValue(n),this.scroll[e].scrollTo(0,(u-r)*this.liHeight,this.rTime,!0)):(this.setValue(this.range[e][0]),this.scroll[e].scrollTo(0,-r*this.liHeight,this.rTime,!0))},showSchool:function(){var e="userInfoSchoolInput",t=this.getValue(e),n=this.getValueIndex(e,t),r="";this.range[e]=[];var i=this.value.schoolProvinceInput;for(var s in schoolList[i].school)this.range[e].push(schoolList[i].school[s].name),r+="<li>"+schoolList[i].school[s].name+"</li>";jQuery("#"+e+" ul").html(r),this.scroll[e].refresh();var o=this.getValueIndex(e,t);o>=0?(this.setValue(t),this.scroll[e].scrollTo(0,(o-n)*this.liHeight,this.rTime,!0)):(this.setValue(this.range[e][0]),this.scroll[e].scrollTo(0,-n*this.liHeight,this.rTime,!0))},showDomain:function(e){var t="userInfoDomainInput",n=this.getValue(t),r=this.getValueIndex(t,n),i="";this.range[t]=[];var s=this.getValue("userInfoOccupationInput"),o=pie.domainList[s];for(var u=0;u<o.length;u++)this.range[t].push(u),i+="<li>"+o[u]+"</li>";jQuery("#"+t+" ul").html(i),this.scroll[t].refresh();var a=this.getValueIndex(t,n);a>=0?(this.setValue(n),this.scroll[t].scrollTo(0,(a-r)*this.liHeight,this.rTime,!0)):(this.setValue(this.range[t][0]),this.scroll[t].scrollTo(0,-r*this.liHeight,this.rTime,!0))},showMaxHeight:function(e){var t="userExpectationMaxHeightInput",n=this.getValue(t),r=this.getValueIndex(t,n),i="";this.range[t]=[];var s=this.getValue("userExpectationMinHeightInput");for(var o=s;o<=230;o++)this.range[t].push(o),i+="<li>"+o+"cm</li>";jQuery("#"+t+" ul").html(i),this.scroll[t].refresh();var u=this.getValueIndex(t,n);u>=0?(this.setValue(n),this.scroll[t].scrollTo(0,(u-r)*this.liHeight,this.rTime,!0)):(this.setValue(this.range[t][0]),this.scroll[t].scrollTo(0,-r*this.liHeight,this.rTime,!0))},showMaxDegree:function(e){var t="userExpectationMaxDegreeInput",n=this.getValue(t),r=this.getValueIndex(t,n),i="";this.range[t]=[];var s=this.getValue("userExpectationMinDegreeInput");for(var o=s;o<pie.degreeList.length;o++)this.range[t].push(o),i+="<li>"+pie.degreeList[o]+"</li>";jQuery("#"+t+" ul").html(i),this.scroll[t].refresh();var u=this.getValueIndex(t,n);u>=0?(this.setValue(n),this.scroll[t].scrollTo(0,(u-r)*this.liHeight,this.rTime,!0)):(this.setValue(this.range[t][0]),this.scroll[t].scrollTo(0,-r*this.liHeight,this.rTime,!0))},showMaxAge:function(e){var t="userExpectationMaxAgeInput",n=this.getValue(t),r=this.getValueIndex(t,n),i="";this.range[t]=[];var s=this.getValue("userExpectationMinAgeInput");for(var o=s;o<=230;o++)this.range[t].push(o),o<0&&(i+="<li>小我"+ -1*o+"岁</li>"),o==0&&(i+="<li>和我同岁</li>"),o>0&&(i+="<li>大我"+o+"岁</li>");jQuery("#"+t+" ul").html(i),this.scroll[t].refresh();var u=this.getValueIndex(t,n);u>=0?(this.setValue(n),this.scroll[t].scrollTo(0,(u-r)*this.liHeight,this.rTime,!0)):(this.setValue(this.range[t][0]),this.scroll[t].scrollTo(0,-r*this.liHeight,this.rTime,!0))}},jPush:{bind:function(){if(typeof cordova=="undefined")return;return cordova.exec(function(e){},function(e){},"jPushPlugin","bind",[{puid:""+pie.user.data.puid}])},unbind:function(){if(typeof cordova=="undefined")return;return cordova.exec(function(e){},function(e){},"jPushPlugin","unbind",[{puid:""+pie.user.data.puid}])}},localNotification:{add:function(e,t){pie.platform=="android"&&window.plugins.statusBarNotification.notify(e,t)},clear:function(){if(typeof cordova=="undefined")return;return cordova.exec(function(e){},function(e){},"localNotification","setApplicationBadge",[0])}},npc:{nickname:"小Pie",headNum:20,liked:!1,headUrl:null,talk:function(e){jQuery.post("http://www.xiaohuangji.com/ajax.php",{para:e},function(e){var t=["请问你在说什么鸟语?","能说句我听得懂的吗?","所以你是在考验我语义分析的能力吗?我听不懂啊","你快别擦键盘了,说的我都听不懂啊","饶了我吧~我真的不知道你在说什么","再说一遍好吗?我刚没听明白"];if(e==""||e.match("<a")){var n=Math.floor(t.length*Math.random());e=t[n]}e=e.replace(/小黄鸡/g,"小Pie"),pie.soundOn&&pie.newMessageMedia.play();var r=pie.tcp.judgeTime(pie.messageTime()),i='<div class="mateTalkBlock" id="'+pie.user.talkRecord.length+'mateTalkBlock"><table><tbody><tr><td valign="top" width="15%"><div class="mateTalkHead" style="background-image:url('+pie.npc.smallHeadUrl+')"></div></td><td valign="top"><div class="mateTalkContent">'+e+'</div><span class="messageTime">'+r+"</span></td></tr></tbody></table></div>";jQuery("#mateTalkPage .scrollArea").append(i),pie.talkScrollArea.refresh();var s=document.getElementById(pie.user.talkRecord.length+"mateTalkBlock");pie.talkScrollArea.scrollToElement(s,100),pie.user.talkRecord.push({mid:1e4*Math.random(),from:pie.mate.info.puid,to:pie.user.data.puid,status:pie.messageStatus.inMessage,content:e,contentType:0,time:pie.messageTime()}),pie.backup()})},init:function(){if(!pie.user.info)return;if(!("sex"in pie.user.info))return;jQuery("#matchMateAvatar").unbind("load"),jQuery("#matchMateAvatar").bind("load",function(){this.width/=pie.dpi,this.style.left=""+ -1*Math.floor((this.width-pie.width)/2)+"px"});var e=1;pie.user.info.sex==1?(e=0,this.headUrl=pie.femaleHeadUrl,this.smallHeadUrl=pie.smallFemaleHeadUrl,pie.mate.info={puid:1234567,nickname:"小Pie",sex:e,height:164,weight:50,current_location:"中国:北京市:海淀区",birthday:"1992-10-18",school:"北京大学",degree:"本科",birth_place:"中国:四川省:重庆市",presentation:"喵,天气真好～",occupation:"学生",domain:"外语",photos:[]},pie.mate.expectations={height_min:170,height_max:180,age_diff_min:0,age_diff_max:3,degree_min:"本科",degree_max:"博士",location_ideal:"中国:北京市:海淀区",location_distance:"同省"},jQuery("#matchMateAvatar").attr("src",this.headUrl)):(this.headUrl=pie.maleHeadUrl,this.smallHeadUrl=pie.smallMaleHeadUrl,pie.mate.info={puid:7654321,nickname:"小Pie",sex:e,height:175,weight:70,current_location:"中国:北京市:海淀区",birthday:"1992-03-13",school:"北京大学",degree:"本科",birth_place:"中国:湖北省:咸宁市",presentation:"今天阳光真好~",occupation:"学生",domain:"计算机",photos:[]},pie.mate.expectations={height_min:160,height_max:180,age_diff_min:-3,age_diff_max:2,degree_min:"本科",degree_max:"博士",location_ideal:"中国:北京市:海淀区",location_distance:"同省"},jQuery("#matchMateAvatar").attr("src",this.headUrl)),pie.mate.info.photos.push({uri:this.smallHeadUrl}),pie.page.mateHomePage.refresh();if(pie.user.talkRecord.length>0){pie.user.talkRecord[0].from!=pie.mate.info.puid&&pie.user.talkRecord[0].to!=pie.mate.info.puid&&(pie.user.talkRecord=[],jQuery("#mateTalkPage .scrollArea").html(""),pie.backup()),pie.page.mateTalkPage.showRecord();return}var t="你好,我是小Pie,很高兴认识你！",n=pie.tcp.judgeTime(pie.messageTime()),r='<div class="mateTalkBlock" id="'+pie.user.talkRecord.length+'mateTalkBlock"><table><tbody><tr><td valign="top" width="15%"><div class="mateTalkHead" style="background-image:url('+this.smallHeadUrl+')"></div></td><td valign="top"><div class="mateTalkContent">'+t+'</div><span class="messageTime">'+n+"</span></td></tr></tbody></table></div>";jQuery("#mateTalkPage .scrollArea").append(r),pie.talkScrollArea.refresh();var i=document.getElementById(pie.user.talkRecord.length+"mateTalkBlock");pie.talkScrollArea.scrollToElement(i,100),pie.user.talkRecord.push({mid:1e4*Math.random(),from:pie.mate.info.puid,to:pie.user.data.puid,status:pie.messageStatus.inMessage,content:t,contentType:0,time:pie.messageTime()}),pie.backup()}},user:{exist:!1,info:null,matchReply:null,curMate:null,matchInfo:null,matchType:null,infoFinished:!1,tips:null,mateAnswerIndex:0,data:null,menuAvatar:null,userHomeAvatar:null,userInfoAvatar:null,userTalkAvatar:null,mateTalkAvatar:null,mateHomeAvatar:null,expectations:null,seeLifeReport:null,seeLoveReport:null,communicationReport:null,personalityReport:null,message:null,talkRecord:[],messageSended:!0,nextMessageIndex:0,curImgIndex:0,autoLogin:function(){pie.showPage("pieMatchIndexPage"),pie.user.messageSended=!0,pie.loginMedia.play(),pie.tcp.init(),this.info&&pie.page.userHomePage.refresh(),this.seeLoveReport&&(pie.page.userSeeLoveTestPage.inited=!0,pie.page.userSeeLoveTestPage.showReport()),this.seeLifeReport&&(pie.page.userSeeLifeTestPage.inited=!0,pie.page.userSeeLifeTestPage.showReport()),this.personalityReport&&(pie.page.userPersonalityTestPage.inited=!0,pie.page.userPersonalityTestPage.showReport()),this.communicationReport&&(pie.page.userCommunicationTestPage.inited=!0,pie.page.userCommunicationTestPage.showReport()),pie.connectionType=="none"?this.matchReply&&pie.page.pieMatchIndexPage.refresh():pie.user.getInfo(0)},getMessage:function(){jQuery.ajax({url:pie.serverBase+"/api/rest/dashboard/posters.json",type:"get",dataType:"json",success:function(e){if(e.status!="success"){e.code=="2002"?pie.confirm("账号已过期,请重新登录",function(){pie.user.logout(0)},!1):pie.remind("获取系统消息失败,错误码:"+e.code+"请报告管理员");return}pie.user.message=e.data},error:function(e){pie.hideLoading(),pie.remind("获取系统消息失败"+e+",这应该是网络问题造成的")}})},initMatch:function(e){if(this.infoFinished){this.getMate(e);return}e&&pie.showLoading("正在初始化配对");var t={token:pie.user.data.access_token};jQuery.ajax({url:pie.serverBase+"/api/rest/users/"+pie.user.data.puid+"/init.json",type:"patch",data:t,dataType:"json",success:function(t){pie.hideLoading(),pie.refreshStart&&pie.endRefresh();if(t.status!="success"){t.code=="2002"?pie.confirm("账号已过期,请重新登录",function(){pie.user.logout(0)},!1):(jQuery("#pieMatchIndexPageMenu").html("体验一下"),jQuery("#matchStatusText").html("参与配对请完善您的信息并上传至少2张照片"),jQuery("#finishInfoButton").css("display","block")),pie.npc.init();return}pie.user.infoFinished=!0,jQuery("#finishInfoButton").css("display","none"),pie.backup(),pie.user.getMate(e)},error:function(e){pie.hideLoading(),pie.remind("初始化配对出错:"+e+",这应该是网络问题造成的")}})},getInfo:function(e){var t={_format:"json",token:pie.user.data.access_token,platform:pie.platform};e&&pie.showLoading("正在同步"),jQuery.ajax({url:pie.serverBase+"/api/rest/users/"+pie.user.data.puid,type:"get",data:t,dataType:"json",success:function(t){pie.hideLoading(),pie.refreshStart&&pie.endRefresh();if(t.status=="error"){t.code=="2002"?pie.confirm("账号已过期,请重新登录",function(){pie.user.logout(0)},!1):pie.remind("获取基本信息出错,错误码:"+t.code+",请报告管理员");return}pie.user.info=t.data[0],pie.user.expectations=t.data[1],pie.user.info.sex==1?(pie.user.info.sex=1,pie.user.tips||(pie.user.tips=pie.maleTips)):(pie.user.info.sex=0,pie.user.tips||(pie.user.tips=pie.femaleTips)),pie.backup(),e||pie.tcp.init(),pie.page.userHomePage.refresh()},error:function(e){pie.hideLoading(),pie.remind("获取用户信息出错:"+e+",这应该是网络问题造成的")}})},submitGPS:function(){if(!pie.gps||!this.data)return;var e={token:this.data.access_token,longitude:pie.gps.longitude,latitude:pie.gps.latitude,altitude:pie.gps.altitude};jQuery.ajax({url:pie.serverBase+"/api/rest/users/"+this.data.puid+"/geo/location.json",type:"put",dataType:"json",data:e,success:function(e){},error:function(e){}})},getMate:function(e){var t={_format:"json",token:this.data.access_token};e&&pie.showLoading("正在获取配对信息"),this.submitGPS(),jQuery.ajax({url:pie.serverBase+"/api/rest/apps/pie_match/result",type:"get",data:t,dataType:"json",success:function(e){pie.hideLoading(),pie.refreshStart&&pie.endRefresh(),pie.user.matchReply=e,pie.page.pieMatchIndexPage.refresh()},error:function(e){pie.hideLoading(),pie.remind
("获取配对信息出错:"+e+",这应该是网络问题造成的")}})},likeMate:function(){pie.confirm("确认要like对方吗?",function(){var e={token:pie.user.data.access_token,target_id:pie.mate.info.puid,type:pie.user.matchType};pie.showLoading("正在提交"),jQuery.ajax({url:pie.serverBase+"/api/rest/apps/pie_match/results/"+pie.user.matchInfo.match_id+"/like.json",type:"patch",data:e,dataType:"json",success:function(e){if(e.status!="success"){pie.hideLoading(),e.code=="2002"?pie.confirm("账号已过期,请重新登录",function(){pie.user.logout(0)},!1):pie.remind("like对方的动作失败,错误码:"+e.code+",请报告管理员");return}pie.user.getMate(1)},error:function(e){pie.hideLoading(),pie.remind("like对方的动作出错:"+e+",这应该是网络问题造成的")}})})},passMate:function(){pie.confirm("确认要pass对方吗?",function(){var e={token:pie.user.data.access_token,target_id:pie.mate.info.puid,type:pie.user.matchType};pie.showLoading("正在提交"),jQuery.ajax({url:pie.serverBase+"/api/rest/apps/pie_match/results/"+pie.user.matchInfo.match_id+"/pass.json",type:"patch",data:e,dataType:"json",success:function(e){if(e.status!="success"){pie.hideLoading(),e.code=="2002"?pie.confirm("账号已过期,请重新登录",function(){pie.user.logout(0)},!1):pie.remind("pass对方出错,错误码:"+e.code+",请报告管理员");return}pie.user.getMate(1)},error:function(e){pie.hideLoading(),pie.remind("pass对方出错:"+e+",这应该是网络问题造成的")}})})},reportMate:function(){pie.page.pieReportPage.change(1),pie.showPage("pieReportPage")},feedBack:function(){pie.page.pieReportPage.change(0),pie.showPage("pieReportPage")},refreshMatch:function(){pie.confirm("你真的要解除和ta的配对关系么?缘分难得啊!",function(){var e={token:pie.user.data.access_token,type:pie.user.matchType};pie.showLoading("正在解除配对"),jQuery.ajax({url:pie.serverBase+"/api/rest/apps/pie_match/results/"+pie.user.matchInfo.match_id+"/break.json",type:"patch",data:e,dataType:"json",success:function(e){if(e.status!="success"){pie.hideLoading(),e.code=="2002"?pie.confirm("账号已过期,请重新登录",function(){pie.user.logout(0)},!1):pie.remind("解除配对出错,错误码:"+e.code+",请报告管理员");return}pie.user.getMate(1)},error:function(e){pie.hideLoading(),pie.remind("解除配对出错:"+e+",这应该是网络问题造成的")}})})},getQuestions:function(e){var t={token:pie.user.data.access_token,number:100};e&&pie.showLoading("正在获取问答题库"),jQuery.ajax({url:pie.serverBase+"/api/rest/apps/pie_match/qa/public/random/questions.json",type:"get",data:t,dataType:"json",success:function(e){pie.hideLoading(),pie.refreshStart&&pie.endRefresh();if(e.status!="success"){e.code=="2002"?pie.confirm("账号已过期,请重新登录",function(){pie.user.logout(0)},!1):pie.remind("获取问答题库出错,错误码:"+e.code+",请报告管理员");return}pie.page.pieQAIndexPage.refresh(e.data)},error:function(e){pie.hideLoading(),pie.remind("获取问答题库出错:"+e+",这应该是网络问题造成的")}})},getSeeLoveTest:function(e){var t="see_love",n={token:pie.user.data.access_token};e&&pie.showLoading("正在加载"),jQuery.ajax({url:pie.serverBase+"/api/rest/apps/pie_test/modules/"+t+"/questions/not/answered.json",type:"get",data:n,dataType:"json",success:function(e){pie.hideLoading(),pie.refreshStart&&pie.endRefresh();if(e.status!="success"){e.code=="2002"?pie.confirm("账号已过期,请重新登录",function(){pie.user.logout(0)},!1):pie.remind("获取测试题库出错,错误码:"+e.code+",请报告管理员");return}e.data.length>0?pie.page.userSeeLoveTestPage.refresh(e.data):pie.page.userSeeLoveTestPage.showReport()},error:function(e){pie.hideLoading(),pie.remind("获取测试题库出错:"+e+",这应该是网络问题造成的")}})},getSeeLifeTest:function(e){var t="see_life",n={token:pie.user.data.access_token};e&&pie.showLoading("正在加载"),jQuery.ajax({url:pie.serverBase+"/api/rest/apps/pie_test/modules/"+t+"/questions/not/answered.json",type:"get",data:n,dataType:"json",success:function(e){pie.hideLoading(),pie.refreshStart&&pie.endRefresh();if(e.status!="success"){e.code=="2002"?pie.confirm("账号已过期,请重新登录",function(){pie.user.logout(0)},!1):pie.remind("获取测试题库出错,错误码:"+e.code+",请报告管理员");return}e.data.length>0?pie.page.userSeeLifeTestPage.refresh(e.data):pie.page.userSeeLifeTestPage.showReport()},error:function(e){pie.hideLoading(),pie.remind("获取测试题库出错:"+e+",这应该是网络问题造成的")}})},getPersonalityTest:function(e){var t="personality",n={token:pie.user.data.access_token};e&&pie.showLoading("正在加载"),jQuery.ajax({url:pie.serverBase+"/api/rest/apps/pie_test/modules/"+t+"/questions/not/answered.json",type:"get",data:n,dataType:"json",success:function(e){pie.hideLoading(),pie.refreshStart&&pie.endRefresh();if(e.status!="success"){e.code=="2002"?pie.confirm("账号已过期,请重新登录",function(){pie.user.logout(0)},!1):pie.remind("获取测试题库出错,错误码:"+e.code+",请报告管理员");return}e.data.length>0?pie.page.userPersonalityTestPage.refresh(e.data):pie.page.userPersonalityTestPage.showReport()},error:function(e){pie.hideLoading(),pie.remind("获取测试题库出错:"+e+",这应该是网络问题造成的")}})},getCommunicationTest:function(e){var t="communication",n={token:pie.user.data.access_token};e&&pie.showLoading("正在加载"),jQuery.ajax({url:pie.serverBase+"/api/rest/apps/pie_test/modules/"+t+"/questions/not/answered.json",type:"get",data:n,dataType:"json",success:function(e){pie.hideLoading(),pie.refreshStart&&pie.endRefresh();if(e.status!="success"){e.code=="2002"?pie.confirm("账号已过期,请重新登录",function(){pie.user.logout(0)},!1):pie.remind("获取测试题库出错,错误码:"+e.code+",请报告管理员");return}e.data.length>0?pie.page.userCommunicationTestPage.refresh(e.data):pie.page.userCommunicationTestPage.showReport()},error:function(e){pie.hideLoading(),pie.remind("获取测试题库出错:"+e+",这应该是网络问题造成的")}})},showImg:function(e){this.curImgIndex=e,window.userSwipe.slide(this.info.photos.length-e-1,0),pie.showPage("userShowImgPage");var t=document.getElementById(e+"userBigPhoto");t.src||(pie.showLoading("正在加载"),t.addEventListener("load",function(){this.width/=pie.dpi,this.style.left=(pie.width-this.width)/2+"px",this.style.top=(pie.height-this.height)/2+"px",pie.hideLoading()}),t.src=pie.serverBase+"/asset/"+pie.user.info.photos[e].uri+"/"+pie.width*pie.dpi+"/"+pie.height*pie.dpi+"/inner/inline")},showImgHeader:function(){jQuery("#userShowImgPage .imgHeader").css("display")=="none"?jQuery("#userShowImgPage .imgHeader").css("display","block"):jQuery("#userShowImgPage .imgHeader").css("display","none")},setHead:function(){var e={token:this.data.access_token,uri:this.info.photos[this.curImgIndex].uri};jQuery.ajax({url:pie.serverBase+"/api/rest/users/"+this.data.puid+"/avatar.json",type:"put",data:e,dataType:"json",success:function(e){if(e.status!="success"){e.code=="2002"?pie.confirm("账号已过期,请重新登录",function(){pie.user.logout(0)},!1):pie.remind("设定头像出错,错误码:"+e.code+",请报告管理员");return}pie.remind("设定头像成功:"),pie.user.getInfo(0)},error:function(e){pie.hideLoading(),pie.remind("设定头像失败:"+e+",这应该是网络问题造成的")}})},deleteHead:function(){var e={token:this.data.access_token,puid:this.data.puid,uri:this.info.photos[this.curImgIndex].uri,_method:"DELETE"};pie.showLoading("正在删除图片"),jQuery.ajax({url:pie.serverBase+"/api/rest/users/"+this.data.puid+"/photo.json",type:"post",data:e,dataType:"json",success:function(e){pie.hideLoading();if(e.status!="success"){e.code=="2002"?pie.confirm("账号已过期,请重新登录",function(){pie.user.logout(0)},!1):pie.remind("删除图片出错,错误码:"+e.code+",请报告管理员");return}var t=pie.user.info.photos;pie.user.info.photos=t.slice(0,pie.user.curImgIndex).concat(t.slice(pie.user.curImgIndex+1)),pie.user.info.photos.length<=0?(pie.showPage("userHomePage"),jQuery("#userHomePhotoArea").html("")):pie.page.userHomePage.photoInit(pie.user.info.photos.length-pie.user.curImgIndex,!0)},error:function(e){pie.hideLoading(),pie.remind("删除图片失败:"+e+",这应该是网络问题造成的")}})},logout:function(e){e?pie.confirm("确认要退出么?",this.doLogout):this.doLogout()},doLogout:function(){pie.pieMoment.userId=-1,window.localStorage.pieMoment=JSON.stringify(pie.pieMoment),pie.jPush.unbind();if(pie.useWeibo){var e=document.getElementById("weiboLoginFrame");e.src="http://weibo.com/logout.php?backurl=%2F",pie.showLoading("正在退出"),e.attachEvent?e.attachEvent("onload",function(){window.location.reload()}):e.onload=function(){window.location.reload()}}else window.location.reload()}},mate:{exist:!1,changed:!1,info:null,expectations:null,questions:null,answers:null,curImgIndex:0,init:function(){pie.page.mateHomePage.refresh(),this.getAnswer()},getAnswer:function(){var e;pie.user.matchType==1?e=pie.aladdin.info.aladdin_id:e=pie.user.matchInfo.match_id;var t={token:pie.user.data.access_token,type:pie.user.matchType,target_id:pie.mate.info.puid};jQuery.ajax({url:pie.serverBase+"/api/rest/apps/pie_match/results/"+e+"/qa/public/questions/all/target/answers.json",type:"get",data:t,dataType:"json",success:function(e){if(e.status!="success"){e.code=="2002"?pie.confirm("账号已过期,请重新登录",function(){pie.user.logout(0)},!1):pie.remind("获取对方回答出错,错误码:"+e.code+",请报告管理员");return}pie.mate.answers=e.data,pie.page.mateHomePage.initAnswer()},error:function(e){pie.hideLoading(),pie.remind("获取对方的回答出错:"+e+",这应该是网络问题造成的")}})},showImg:function(e){this.curImgIndex=e,window.mateSwipe.slide(this.info.photos.length-e-1,0),pie.showPage("mateShowImgPage");var t=document.getElementById(e+"mateBigPhoto");t.src||(pie.showLoading("正在加载"),t.addEventListener("load",function(){this.width/=pie.dpi,this.style.left=(pie.width-this.width)/2+"px",this.style.top=(pie.height-this.height)/2+"px",pie.hideLoading()}),pie.mate.exist?t.src=pie.serverBase+"/asset/"+pie.mate.info.photos[e].uri+"/"+pie.width*pie.dpi+"/"+pie.height*pie.dpi+"/inner/inline":t.src=pie.npc.headUrl)},showImgHeader:function(){jQuery("#mateShowImgPage .imgHeader").css("display")=="none"?jQuery("#mateShowImgPage .imgHeader").css("display","block"):jQuery("#mateShowImgPage .imgHeader").css("display","none")},controlLeft:function(){if(!this.exist){pie.npc.liked?pie.showPage("mateTalkPage"):pie.confirm("你确认要like小Pie吗?双方都选择like之后你们将取得联系,之前他不会知道你的选择(这只是一个教程)",function(){pie.npc.liked=!0,jQuery("#matchControlBox").css("display","block"),jQuery("#mateDecisionBox").css("font-size","20px"),jQuery("#mateDecisionBox").css("top","23px"),jQuery("#mateDecisionText i").removeClass("icon-ok"),jQuery("#mateDecisionText i").addClass("icon-heart"),jQuery("#mateDecisionText i").css("display","inline"),jQuery("#mateDecisionText span").html("配对成功"),jQuery("#countDownClock").css("display","none"),jQuery("#leftButtonIcon i").removeClass("icon-heart"),jQuery("#leftButtonIcon i").addClass("icon-comment"),jQuery("#leftButtonText").html("talk"),jQuery("#matchControlLeftButton").css("background-color","rgb(8, 143, 148)"),jQuery("#rightButtonIcon i").removeClass("icon-play"),jQuery("#rightButtonIcon i").addClass("icon-refresh"),jQuery("#rightButtonText").html("break"),pie.remind("你已成功like小Pie,小Pie也选择了like,你们配对成功啦,快点击talk按钮跟小Pie聊聊吧!")});return}if(pie.user.matchType==1){if(!pie.aladdin.info)return;switch(pie.aladdin.info.aladdin_status){case"successful aladdin":pie.showPage("mateTalkPage");break;case"not decided yet":pie.aladdin.likeFollower();break;case"failed aladdin":break;case"break up match":}return}if(!pie.user.matchInfo)return;switch(pie.user.matchInfo.match_status){case"successful aladdin":case"successful match":pie.showPage("mateTalkPage");break;case"not decided yet":switch(pie.user.matchInfo.my_decision){case"like":break;case"pass":break;case"unknown":switch(pie.user.matchInfo.target_decision){case"unknown":pie.user.likeMate();break;case"decision_made":pie.user.likeMate()}break;default:}break;case"failed aladdin":case"failed match":switch(pie.user.matchInfo.my_decision){case"unknown":pie.user.likeMate();break;case"like":break;case"pass":}break;case"break up match":}},controlCenter:function(){if(!this.exist){pie.showPage("mateHomePage");return}if(pie.user.matchType==1){pie.aladdin.lookFollower();return}if(!pie.user.matchInfo)return;switch(pie.user.matchInfo.match_status){case"successful aladdin":case"successful match":pie.showPage("mateHomePage");break;case"not decided yet":pie.showPage("mateHomePage");break;case"failed aladdin":case"failed match":switch(pie.user.matchInfo.my_decision){case"unknown":pie.showPage("mateHomePage");break;case"like":break;case"pass":}break;case"break up match":}},controlRight:function(){if(!this.exist){pie.npc.liked?pie.confirm("你确认要解除和小Pie的配对吗?(这只是一个教程)",function(){pie.remind("你已成功解除了和小Pie的配对,下次配对将在下个中午12点准时开始!"),jQuery("#matchControlBox").css("display","none"),jQuery("#mateDecisionText i").css("display","none"),jQuery("#mateDecisionText span").html("配对失败")}):pie.confirm("你确认要pass小Pie吗?(这只是一个教程)",function(){pie.remind("你已成功pass小Pie,你们的配对失败了,下次配对将在下个中午12点准时开始!"),jQuery("#matchControlBox").css("display","none"),jQuery("#mateDecisionText i").css("display","none"),jQuery("#mateDecisionText span").html("配对失败")});return}if(pie.user.matchType==1){if(!pie.aladdin.info)return;switch(pie.aladdin.info.aladdin_status){case"successful aladdin":pie.aladdin.refreshAladdin();break;case"not decided yet":pie.aladdin.passFollower();break;case"failed aladdin":break;case"break up match":}return}if(!pie.user.matchInfo)return;switch(pie.user.matchInfo.match_status){case"successful aladdin":case"successful match":pie.user.refreshMatch();break;case"not decided yet":switch(pie.user.matchInfo.my_decision){case"like":break;case"pass":break;case"unknown":pie.user.passMate();break;default:}break;case"failed aladdin":case"failed match":switch(pie.user.matchInfo.my_decision){case"unknown":pie.user.passMate();break;case"like":break;case"pass":}break;case"break up match":}}},aladdin:{info:null,personInfo:null,personExpecation:null,areaDisplay:!1,curFollower:null,init:function(e){var t=Math.min(4,this.personInfo.length),n=Math.floor(pie.width*.2);for(var r=0;r<4;r++)r<t?(jQuery("#follower"+r+" img").attr("src",pie.serverBase+"/asset/"+this.personInfo[r].avatar.uri+"/"+n+"/"+n+"/smart/inline"),jQuery("#follower"+r).css("display","block")):jQuery("#follower"+r).css("display","none");e&&(jQuery(".follower").css("width",n),this.showFollower(0))},showArea:function(){this.areaDisplay=!0,jQuery("#matchMateHead").css("display","none"),jQuery("#pieMatchType").css("display","none"),jQuery("#matchControlBox").css("display","none"),jQuery("#aladdinArea").css("display","block")},hideArea:function(){this.areaDisplay=!1,jQuery("#matchMateHead").css("display","block"),jQuery("#pieMatchType").css("display","block"),jQuery("#matchControlBox").css("display","block"),jQuery("#aladdinArea").css("display","none")},showFollower:function(e){var t=Math.floor(pie.width*.9-6);jQuery("#matchMateAvatar").attr("src",pie.serverBase+"/asset/"+this.personInfo[e].avatar.uri+"/"+t+"/"+t+"/smart/inline"),this.hideArea(),this.curFollower=e,pie.mate.info=this.personInfo[e],pie.mate.expectations=this.personExpecation[e]},deleteFollower:function(e){var t={token:pie.user.data.access_token,target_id:this.personInfo[e].puid,type:pie.user.matchType};jQuery.ajax({url:pie.serverBase+"/api/rest/apps/pie_match/results/"+pie.aladdin.info.aladdin_id+"/pass.json",type:"patch",data:t,dataType:"json",success:function(e){if(e.status!="success"){e.code=="2002"?pie.confirm("账号已过期,请重新登录",function(){pie.user.logout(0)},!1):pie.remind("pass对方出错,错误码:"+e.code+",请报告管理员");return}},error:function(e){pie.hideLoading(),pie.remind("pass对方的动作出错:"+e+",这应该是网络问题造成的")}}),this.personInfo=this.personInfo.slice(0,e).concat(this.personInfo.slice(e+1)),this.personExpecation=this.personExpecation.slice(0,e).concat(this.personExpecation.slice(e+1)),this.init(0)},command:function(){this.areaDisplay?this.hideArea():this.showArea()},lookFollower:function(){pie.mate.init(),pie.showPage("mateHomePage")},passFollower:function(){pie.confirm("确认要pass对方吗?",function(){var e={token:pie.user.data.access_token,target_id:pie.mate.info.puid,type:pie.user.matchType};pie.showLoading("正在提交"),jQuery.ajax({url:pie.serverBase+"/api/rest/apps/pie_match/results/"+pie.aladdin.info.aladdin_id+"/pass.json",type:"patch",data:e,dataType:"json",success:function(e){pie.hideLoading();if(e.status!="success"){e.code=="2002"?pie.confirm("账号已过期,请重新登录",function(){pie.user.logout(0)},!1):pie.remind("pass对方出错,错误码:"+e.code+",请报告管理员");return}pie.aladdin.deleteFollower(pie.aladdin.curFollower),pie.aladdin.showArea()},error:function(e){pie.hideLoading(),pie.remind("pass对方的动作出错:"+e+",这应该是网络问题造成的")}})})},likeFollower:function(){pie.confirm("确认要like对方吗?",function(){var e={token:pie.user.data.access_token,target_id:pie.mate.info.puid,type:pie.user.matchType};pie.showLoading("正在提交"),jQuery.ajax({url:pie.serverBase+"/api/rest/apps/pie_match/results/"+pie.aladdin.info.aladdin_id+"/like.json",type:"patch",data:e,dataType:"json",success:function(e){pie.hideLoading();if(e.status!="success"){e.code=="2002"?pie.confirm("账号已过期,请重新登录",function(){pie.user.logout(0)},!1):pie.remind("like对方出错,错误码:"+e.code+",请报告管理员");return}jQuery("#statusText").html("配对成功,加油!"),pie.aladdin.info.aladdin_status="successful match",jQuery("#pieMatchType").css("display","none"),jQuery("#matchControlLeftButton i").removeClass("icon-remove"),jQuery("#matchControlLeftButton i").addClass("icon-refresh"),jQuery("#matchControlRightButton i").removeClass("icon-heart"),jQuery("#matchControlRightButton i").addClass("icon-comment")},error:function(e){pie.hideLoading(),pie.remind("like对方的动作出错:"+e+",这应该是网络问题造成的")}})})},refreshAladdin:function(){pie.confirm("你真的要解除和ta的配对关系么?缘分难得啊!",function(){var e={token:pie.user.data.access_token,type:pie.user.matchType};pie.showLoading("正在解除配对"),jQuery.ajax({url:pie.serverBase+"/api/rest/apps/pie_match/results/"+pie.aladdin.info.aladdin_id+"/break.json",type:"patch",data:e,dataType:"json",success:function(e){pie.hideLoading();if(e.status!="success"){e.code=="2002"?pie.confirm("账号已过期,请重新登录",function(){pie.user.logout(0)},!1):pie.remind("解除关系出错,错误码:"+e.code+",请报告管理员");return}pie.npc.init(),jQuery("#statusText").html("你已解除了本次配对,下次配对只剩")},error:function(e){pie.hideLoading(),pie.remind("解除配对碰到出错:"+e+",这应该是网络问题造成的")}})})}},leftMenu:{id:"pieLeftMenu",display:!1,scrollArea:null,show:function(){this.display=!0,jQuery("#"+this.id).css("display","block"),this.scrollArea||(this.scrollArea=new iScroll(this.id,{useTransition:!0,hScroll:!1,checkDOMChanges:!1}))},hide:function(){this.display=!1,jQuery("#"+this.id).css("display","none")}},rightMenu:{id:"pieRightMenu",display:!1,scrollArea:null,autoPlay:null,curTipIndex:-1,show:function(){this.display=!0,jQuery("#"+this.id).css("display","block"),this.scrollArea||(this.scrollArea=new iScroll(this.id,{useTransition:!0,hScroll:!1,checkDOMChanges:!1})),this.curTipIndex<0&&(this.curTipIndex=Math.floor(pie.user.tips.length*Math.random())),this.showTips(),this.autoPlay=setInterval(function(){jQuery("#pieTips").css("opacity","0.2"),setTimeout(function(){pie.rightMenu.showTips()},500)},9e3)},hide:function(){this.display=!1,jQuery("#"+this.id).css("display","none"),clearInterval(this.autoPlay),this.autoPlay=null},showTips:function(){this.curTipIndex++,this.curTipIndex%=pie.user.tips.length,jQuery("#tipContent").html(pie.user.tips[this.curTipIndex]),jQuery("#pieTips").css("opacity","1")}},page:{pieLoginPage:{id:"pieLoginPage",needScroll:!0,scrollArea:null,init:function(){},submit:function(){var e=jQuery("#pieLoginAccountInput").val();if(e==""){pie.remind("帐号不能为空"),jQuery("#pieLoginAccountInput").focus();return}pie.curLoginAccount=e;var t=/^[a-zA-Z0-9]{6,36}$/,n=jQuery("#pieLoginPasswordInput").val();if(!t.test(n)){pie.remind("帐号或密码错误"),jQuery("#pieLoginPasswordInput").focus();return}pie.curLoginPassword=n;var r={_format:"json",app_token:"app_token",userkey:e,passwd:n};pie.showLoading("正在登录"),jQuery.ajax({url:pie.serverBase+"/api/auth/token/via/passwd",type:"post",data:r,dataType:"json",success:function(e){pie.hideLoading();if(e.status=="error")switch(e.code){case 1011:pie.remind("请输入正确的帐号");break;case 1012:pie.remind("请输入密码");break;case 1013:pie.remind("帐号不存在");break;case 1014:pie.remind("帐号已过期"),pie.showPage("pieResetByEmailPage");break;case 1015:pie.remind("密码不正确");break;case 1016:pie.remind("帐号未激活"),pie.showPage("pieActivatePage");break;case 1018:pie.remind("帐号被禁用"),pie.showPage("pieActivatePage");break;case 2002:pie.confirm("账号已过期,请重新登录",function(){pie.user.logout(0)},!1);break;default:pie.remind("登录碰到未知错误:"+e.reason)}else{pie.user.exist=!0,pie.user.account=r.userkey,pie.user.data=e.data,pie.jPush.bind(),pie.user.getInfo(0);var t={account:r.userkey,data:pie.user.data,info:null,curMate:null,matchReply:null,tips:null,infoFinished:!1,talkRecord:[],mateAnswerIndex:null,messageSended:!0,nextMessageIndex:0,menuAvatar:null,userHomeAvatar:null,userInfoAvatar:null,userTalkAvatar:null,mateTalkAvatar:null,mateHomeAvatar:null,expectations:null,seeLifeReport:null,seeLoveReport:null,communicationReport:null,personalityReport:null};if(pie.pieMoment==undefined)pie.pieMoment={users:[t],userId:0};else{var n=!1;for(var i=0;i<pie.pieMoment.users.length;i++)if(pie.pieMoment.users[i].account==r.userkey){pie.pieMoment.userId=i,pie.pieMoment.users[i].data=pie.user.data,n=!0;break}n?pie.getLocalData():(pie.pieMoment.users.push(t),pie.pieMoment.userId=pie.pieMoment.users.length-1)}pie.backup(),pie.showPage("pieMatchIndexPage"),pie.loginMedia.play()}},error:function(e){pie.hideLoading(),pie.remind("登录碰到未知错误,你的网络连接状况不太行吧?连不上啊:"+e)}});return},listenInput:function(e){var t=e||window.event;t.keyCode==13&&this.submit()}},pieRegPage:{id:"pieRegPage",backPageId:"pieLoginPage",needScroll:!0,scrollArea:null,curSex:1,title:"注册",init:function(){},chooseSex:function(e){this.curSex=e,e?(jQuery("#chooseMale").css("color","rgb(9, 172, 165)"),jQuery("#chooseFemale").css("color","#aaa")):(jQuery("#chooseFemale").css("color","rgb(255, 40, 49)"),jQuery("#chooseMale").css("color","#aaa"))},submit:function(){var e=/[0-9]{11}$/,t=jQuery("#pieRegMobileInput").val();if(!e.test(t)){pie.remind("请输入正确的11位手机号"),jQuery("#pieRegMobileInput").focus();return}var n=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/,r=jQuery("#pieRegEmailInput").val();if(!n.test(r)){pie.remind("请输入正确的邮箱"),jQuery("#pieRegEmailInput").focus();return}var i=/^[a-zA-Z0-9]{6,36}$/,s=jQuery("#pieRegPasswordInput").val();if(!i.test(s)){pie.remind("请输入6~36位字符的密码"),jQuery("#pieRegPasswordInput").focus();return}pie.showLoading("正在注册");var o={app_token:"app_token",_format:"json",mobile_phone:t,email:r,passwd:s,sex:this.curSex};jQuery.ajax({url:pie.serverBase+"/api/auth/account/register/via/mobile/phone",type:"post",data:o,dataType:"json",success:function(e){pie.hideLoading();if(e.status=="success")pie.remind("激活码已发至您的手机,请查看"),pie.showPage("pieActivatePage");else switch(e.code){case 1081:pie.remind("请输入正确的信息");break;case 1082:pie.remind("用户名已被注册");break;case 1083:pie.remind("该邮箱已被注册");break;case 1084:pie.remind("该手机已被注册");break;default:pie.remind("注册未知错误:"+e.message)}},error:function(e){pie.hideLoading(),pie.remind("激活码发送失败:"+e+",这应该是网络问题造成的")}})},listenInput:function(e){var t=e||window.event;t.keyCode==13&&this.submit()}},pieActivatePage:{id:"pieActivatePage",backPageId:"pieLoginPage",needScroll:!0,scrollArea:null,title:"激活",init:function(){},submit:function(){var e=jQuery("#pieActivateInput").val(),t=/^[0-9]{6}$/;if(!t.test(e)){pie.remind("请输入正确的6位验证码"),jQuery("#pieActivateInput").focus();return}var n=jQuery("#pieRegMobileInput").val()||pie.curLoginAccount;pie.showLoading("正在激活");var r={_format:"json",app_token:"app_token",mobile_phone:n,security_code:e};jQuery.ajax({url:pie.serverBase+"/api/auth/account/activate/by/security/code",type:"post",data:r,dataType:"json",success:function(e){pie.hideLoading();if(e.status=="success"){var t=jQuery("#pieRegMobileInput").val()||pie.curLoginAccount;jQuery("#pieLoginAccountInput").val(t);var n=jQuery("#pieRegPasswordInput").val()||pie.curLoginPassword;jQuery("#pieLoginPasswordInput").val(n),pie.page.pieLoginPage.submit()}else pie.remind("激活码错误"),jQuery("#pieActivateInput").val("")},error:function(e){pie.hideLoading(),pie.remind("提交激活码失败:"+e+",这应该是网络问题造成的")}});return},listenInput:function(e){var t=e||window.event;t.keyCode==13&&this.submit()}},pieFindBackPasswordPage:{id:"pieFindBackPasswordPage",backPageId:"pieLoginPage",needScroll:!0,scrollArea:null,title:"找回密码",init:function(){},getSms:function(){var e=jQuery("#findBackPasswordMobileInput").val(),t=/[0-9]{11}$/;if(!t.test(e)){pie.remind("请输入正确的11位手机号"),jQuery("#findBackPasswordMobileInput").focus();return}var n={_format:"json",app_token:"app_token",mobile_phone:e};pie.showLoading("正在获取手机验证码"),jQuery.ajax({url:pie.serverBase+"/api/auth/account/reset/passwd/via/mobile/phone",type:"get",data:n,dataType:"json",success:function(e){pie.hideLoading();if(e.status!="success"){pie.remind("发送验证码失败，请报告管理员");return}jQuery("#resetGetSmsArea").css("display","none"),jQuery("#resetInputSmsArea").css("display","block")},error:function(e){pie.hideLoading(),pie.remind("发送验证码失败:"+e+",这应该是网络问题造成的")}});return},submitReset:function(){var e=jQuery("#findBackPasswordMobileInput").val(),t=jQuery("#findBackPasswordSmsInput").val(),n=jQuery("#findBackPasswordNewPasswordInput").val(),r=/^[0-9]{6}$/;if(!r.test(t)){pie.remind("请输入正确的6位验证码"),jQuery("#findBackPasswordSmsInput").focus();return}var i=/^[a-zA-Z0-9]{6,36}$/;if(!i.test(n)){pie.remind("请输入6～36位密码"),jQuery("#findBackPasswordNewPasswordInput").focus();return}var s={_format:"json",app_token:"app_token",mobile_phone:e,code:t,new_passwd:n};pie.showLoading("正在重置密码"),jQuery.ajax({url:pie.serverBase+"/api/auth/account/reset/passwd/by/security/code",type:"post",data:s,dataType:"json",success:function(e){pie.hideLoading();if(e.status!="success"){pie.remind("验证码错误");return}var t=jQuery("#findBackPasswordMobileInput").val(),n=jQuery("#findBackPasswordNewPasswordInput").val();jQuery("#pieLoginAccountInput").val(t),jQuery("#pieLoginPasswordInput").val(n),pie.page.pieLoginPage.submit()},error:function(e){pie.hideLoading(),pie.remind("提交验证码出错:"+e+",这应该是网络问题造成的")}});return}},userInputPage:{id:"userInputPage",backPageId:"userHomePage",needScroll:!0,scrollArea:null,title:"输入",inputType:null,curMobile:null,init:function(){},showInput:function(e){jQuery("#userInputPage").css("display","block"),jQuery(".inputArea").css("display","none"),jQuery("#"+e+"Area").css("display","block");var t=pie.select;switch(e){case"userInfoMobile":this.title="绑定手机",this.inputType=0;break;case"userInfoNickname":this.title="昵称",this.inputType=1;break;case"userInfoPresentation":this.title="自我介绍",this.inputType=2;break;case"userInfoRealname":this.title="真实姓名",this.inputType=2;break;case"userInfoHeight":this.title="身高",this.inputType=2,t.init("userInfoHeightInput");break;case"userInfoWeight":this.title="体重",this.inputType=2,t.init("userInfoWeightInput");break;case"userInfoBirthday":this.title="生日",this.inputType=2,t.init("userInfoBirthdayYearInput"),t.init("userInfoBirthdayMonthInput"),t.init("userInfoBirthdayDayInput");break;case"userInfoCurrentLocation":this.title="现居地",this.inputType=2,t.init("userInfoCurrentLocationProvinceInput"),t.init("userInfoCurrentLocationCityInput");break;case"userInfoBirthPlace":this.title="籍贯",this.inputType=2,t.init("userInfoBirthPlaceProvinceInput"),t.init("userInfoBirthPlaceCityInput");break;case"userInfoSchool":this.title="学校",this.inputType=2,t.init("schoolProvinceInput"),t.init("userInfoSchoolInput");break;case"userInfoDegree":this.title="学历",this.inputType=2,t.init("userInfoDegreeInput");break;case"userInfoOccupation":this.title="职业",this.inputType=2,t.init("userInfoOccupationInput"),t.init("userInfoDomainInput");break;case"userExpectationHeight":this.title="身高要求",this.inputType=3,t.init("userExpectationMinHeightInput"),t.init("userExpectationMaxHeightInput");break;case"userExpectationAge":this.title="年龄要求",this.inputType=3,t.init("userExpectationMinAgeInput"),t.init("userExpectationMaxAgeInput");break;case"userExpectationDegree":this.title="学历要求",this.inputType=3,t.init("userExpectationMinDegreeInput"),t.init("userExpectationMaxDegreeInput");break;case"userExpectationIdealLocation":this.title="理想城市",this.inputType=3,t.init("userExpectationIdealLocationProvinceInput"),t.init("userExpectationIdealLocationCityInput");break;case"userExpectationLocationDistance":this.title="距离要求",this.inputType=3,t.init("userExpectationLocationDistanceInput");break;default:this.title="未知情况"}jQuery("#inputTitle").html(this.title),setTimeout(function(){jQuery("#userInputPage").css("-webkit-transform","translate3d("+pie.width+"px,0,0)")},0)},getSms:function(){var e=jQuery("#bindMobileInput").val();this.curMobile=e;var t=/[0-9]{11}$/;if(!t.test(e)){pie.remind("请输入正确的11位手机号"),jQuery("#bindMobileInput").focus();return}var n={token:pie.user.data.access_token,puid:pie.user.data.puid,mobile_phone:e};pie.showLoading("正在获取手机验证码"),jQuery.ajax({url:pie.serverBase+"/api/rest/users/"+pie.user.data.puid+"/mobile/phone.json",type:"put",data:n,dataType:"json",success:function(e){pie.hideLoading();if(e.status!="success"){e.code==2042?pie.remind("不能重复绑定相同的手机"):pie.remind("发送验证码失败，错误码:"+e.code+",请报告管理员");return}pie.remind("验证码已经发到手机:"+pie.page.userInputPage.curMobile+",请查收"),jQuery("#bindMobileInput").css("display","none"),jQuery("#bindMobileSmsInput").css("display","block"),pie.page.userInputPage.inputType=-1},error:function(e){pie.hideLoading(),pie.remind("发送验证码失败:"+e+",这应该是网络问题造成的")}})},codeSubmit:function(){var e=jQuery("#bindMobileSmsInput").val(),t=/^[0-9]{6}$/;if(!t.test(e)){pie.remind("请输入正确的6位验证码"),jQuery("#bindMobileSmsInput").focus();return}jQuery("#bindMobileSmsInput").val("");var n={token:pie.user.data.access_token,channel:"mobile",code:e};pie.showLoading("正在重置密码"),jQuery.ajax({url:pie.serverBase+"/api/rest/users/"+pie.user.data.puid+"/verify.json",type:"patch",data:n,dataType:"json",success:function(e){pie.hideLoading();if(e.status!="success"){pie.remind("验证码错误");return}jQuery("#userInputPage").css("-webkit-transform","translate3d(0,0,0)"),setTimeout(function(){jQuery("#userInputPage").css("display","none")},300),jQuery("#bindGetSmsArea").css("display","block"),jQuery("#bindInputSmsArea").css("display","none"),pie.remind("绑定手机成功"),jQuery("#userInfoMobile .userInfoItemContent").html(pie.page.userInputPage.curMobile)},error:function(e){pie.hideLoading(),pie.remind("提交验证码出错:"+e+",这应该是网络问题造成的")}})},submitUserExpectation:function(){var e=pie.select,t=e.getValue("userExpectationMinHeightInput"),n=e.getValue("userExpectationMaxHeightInput"),r=pie.degreeList[e.getValue("userExpectationMinDegreeInput")],i=pie.degreeList[e.getValue("userExpectationMaxDegreeInput")],s=e.getValue("userExpectationMinAgeInput"),o=e.getValue("userExpectationMaxAgeInput"),u="中国:"+e.getValue("userExpectationIdealLocationProvinceInput")+":"+e.getValue("userExpectationIdealLocationCityInput"),a=e.getValue("userExpectationLocationDistanceInput"),f={token:pie.user.data.access_token,height_min:t,height_max:n,degree_min:r,degree_max:i,age_diff_min:s,age_diff_max:o,location_ideal:u,location_distance:a};pie.showLoading("正在更新"),jQuery.ajax({url:pie.serverBase+"/api/rest/apps/pie_match/expectations.json",type:"put",data:f,dataType:"json",success:function(e){pie.hideLoading(),e.status!="success"?e.code=="2002"?pie.confirm("账号已过期,请重新登录",function(){pie.user.logout(0)},!1):pie.remind("提交期望出现未知错误,错误码:"+e.code+",请报告管理员"):(pie.remind("更新配对要求成功"),jQuery("#userInputPage").css("-webkit-transform","translate3d(0,0,0)"),setTimeout(function(){jQuery("#userInputPage").css("display","none")},300),pie.user.getInfo(0))},error:function(e){pie.hideLoading(),pie.remind("提交用户期望信息出错:"+e+",这应该是网络问题造成的")}})},updateInfo:function(){var e=pie.select,t=jQuery("#userInfoRealnameInput").val(),n="中国:"+e.getValue("userInfoCurrentLocationProvinceInput")+":"+e.getValue("userInfoCurrentLocationCityInput"),r=parseInt(e.getValue("userInfoBirthdayYearInput")),i=parseInt(e.getValue("userInfoBirthdayMonthInput")),s=parseInt(e.getValue("userInfoBirthdayDayInput"));i<10&&(i="0"+i),s<10&&(s="0"+s);var o=r+"-"+i+"-"+s,u=e.getValue("userInfoHeightInput"),a=e.getValue("userInfoWeightInput"),f=e.getValue("userInfoSchoolInput"),l=e.getValue("userInfoDegreeInput"),c=jQuery("#userInfoPresentationInput").val(),h="中国:"+e.getValue("userInfoBirthPlaceProvinceInput")+":"+e.getValue("userInfoBirthPlaceCityInput"),p=e.getValue("userInfoOccupationInput"),d=pie.occupationList[p],v=e.getValue("userInfoDomainInput"),m=pie.domainList[p][v],g={token:pie.user.data.access_token,realname:t,birthday:o,current_location:n,height:u,weight:a,school:f,degree:l,presentation:c,birth_place:h,occupation:d,domain:m};pie.showLoading("正在提交信息"),jQuery.ajax({url:pie.serverBase+"/api/rest/users/"+pie.user.data.puid+".json",type:"put",data:g,dataType:"json",success:function(e){pie.hideLoading(),e.status!="success"?e.code=="2002"?pie.confirm("账号已过期,请重新登录",function(){pie.user.logout(0)}):pie.remind("提交信息出现未知错误,错误码:"+e.code+",请报告管理员"):(pie.remind("更新信息成功"),jQuery("#userInputPage").css("-webkit-transform","translate3d(0,0,0)"),setTimeout(function(){jQuery("#userInputPage").css("display","none")},300),pie.user.getInfo(0))},error:function(e){pie.hideLoading(),pie.remind("提交用户基本信息出错:"+e+",这应该是网络问题造成的")}})},updateNickname:function(){var e=jQuery("#userInfoNicknameInput").val();if(e==""){pie.remind("昵称不能为空");return}var t={token:pie.user.data.access_token,nickname:e};pie.showLoading("正在检测昵称是否重复"),jQuery.ajax({url:pie.serverBase+"/api/rest/user/nickname.json",type:"put",data:t,dataType:"json",
success:function(e){pie.hideLoading(),e.status=="success"?(pie.remind("修改昵称成功"),jQuery("#userInputPage").css("-webkit-transform","translate3d(0,0,0)"),setTimeout(function(){jQuery("#userInputPage").css("display","none")},300),pie.user.getInfo(0)):pie.confirm("很遗憾,昵称已被使用...请重新选择",function(){jQuery("#userInfoNicknameInput").val(""),jQuery("#userInfoNicknameInput").focus()})},error:function(e){pie.hideLoading(),pie.remind("修改昵称碰到未知错误:"+e+",这应该是网络问题造成的")}})},submitQuestion:function(){var e=jQuery("#askQuestionInput").val();if(e=="")return;pie.tcp.askQuestion(e),pie.showLoading("正在提交问题")},bindEmail:function(){var e=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/,t=jQuery("#bindEmailInput").val();if(!e.test(t)){pie.remind("请输入正确的邮箱"),jQuery("#bindEmailInput").focus();return}var n={token:pie.user.data.access_token,email:t};pie.showLoading("正在提交"),jQuery.ajax({url:pie.serverBase+"/api/rest/users/"+pie.user.data.puid+"/email.json",type:"put",data:n,dataType:"json",success:function(e){pie.hideLoading(),e.status=="success"?(pie.remind("提交成功,我们已经发送了一封验证邮件到:"+t+",请尽快前去验证"),jQuery("#userInputPage").css("-webkit-transform","translate3d(0,0,0)"),setTimeout(function(){jQuery("#userInputPage").css("display","none")},300),pie.user.getInfo(0)):e.code==2031?pie.confirm("很遗憾,该邮箱已被使用...请重新输入",function(){jQuery("#bindEmailInput").val(""),jQuery("#bindEmailInput").focus()}):pie.remind("绑定邮箱出现未知错误,错误码:"+e.code+",请报告管理员")},error:function(e){pie.hideLoading(),pie.remind("绑定邮箱出现未知错误,这应该是网络问题造成的")}})},submit:function(){pie.curInputId&&jQuery("#"+pie.curInputId).blur();switch(this.inputType){case-1:this.codeSubmit();break;case 0:this.getSms();break;case 1:this.updateNickname();break;case 2:this.updateInfo();break;case 3:this.submitUserExpectation();break;case 4:this.submitQuestion();break;case 5:this.bindEmail()}},cancel:function(){pie.curInputId&&jQuery("#"+pie.curInputId).blur(),jQuery("#userInputPage").css("-webkit-transform","translate3d(0,0,0)"),setTimeout(function(){jQuery("#userInputPage").css("display","none")},300),this.inputType==4&&setTimeout(function(){pie.reduceLeft()},100)}},renrenLoginPage:{id:"renrenLoginPage",backPageId:"pieLoginPage",title:"人人登录",inited:!1,init:function(){if(this.inited)return;this.inited=!0;var e=document.createElement("iframe"),t=pie.serverBase.slice(7,10)+".";t!="www."&&t!="dev."&&(t="");var n="http://graph.renren.com/login?redirect_uri=http%3A%2F%2Fgraph.renren.com%2Foauth%2Fauthorize%3Fclient_id%3Db29edbb8c9154c2f9a97d00e96138b66%26redirect_uri%3Dhttp%253A%252F%252F"+t+"piemoment.com%252Foauth%252Flogin_check%252Finner%252Frenren%26response_type%3Dcode%26display%3Dtouch%26scope%3Dread_user_album%2Bread_user_photo%2Bread_user_feed%2Bpublish_feed%2Bphoto_upload%2Bread_user_status%26state%3D1bd7cd029976e6f20ef14ede386cd6a2%26pp%3D1%26origin%3D00000&post_form_id=feccdf9a033fd1df450cc9c1e234e0cd-10-1374774007525",r="http://graph.renren.com/login?renew=true&redirect_uri=http%3A%2F%2Fgraph.renren.com%2Foauth%2Fauthorize%3Fclient_id%3Db29edbb8c9154c2f9a97d00e96138b66%26redirect_uri%3Dhttp%253A%252F%252F"+t+"piemoment.com%252Foauth%252Flogin_check%252Finner%252Frenren%26response_type%3Dcode%26display%3Dtouch%26scope%3Dread_user_album%2Bread_user_photo%2Bread_user_feed%2Bpublish_feed%2Bphoto_upload%2Bread_user_status%26state%3D1bd7cd029976e6f20ef14ede386cd6a2%26pp%3D1%26origin%3D00000&post_form_id=feccdf9a033fd1df450cc9c1e234e0cd-10-1374774007525";e.id="renrenLoginFrame",e.attachEvent?e.attachEvent("onload",function(){pie.hideLoading()}):e.onload=function(){pie.hideLoading()},pie.showLoading("正在加载"),pie.pieMoment?pie.pieMoment.userId<0?e.src=r:e.src=n:e.src=r,document.getElementById("renrenLoginPage").appendChild(e),jQuery("#renrenLoginFrame").css("min-height",pie.height-pie.headerHeight+55)}},weiboLoginPage:{id:"weiboLoginPage",backPageId:"pieLoginPage",title:"微博登录",inited:!1,init:function(){if(this.inited)return;this.inited=!0;var e=document.createElement("iframe"),t=pie.serverBase.slice(7,10)+".";t!="www."&&t!="dev."&&(t="");var n="https://api.weibo.com/oauth2/authorize?client_id=3912447897&response_type=code&redirect_uri=http%3A%2F%2F"+t+"piemoment.com%2Fweb%2Fapp_dev.php%2Foauth%2Flogin_check%2Finner%2Fweibo&state=cbbdd76851674d47cc47b8bd1ca46ecb&scope=all&display=mobile";e.id="weiboLoginFrame",e.attachEvent?e.attachEvent("onload",function(){pie.hideLoading()}):e.onload=function(){pie.hideLoading()},pie.showLoading("正在加载"),e.src=n,document.getElementById("weiboLoginPage").appendChild(e),jQuery("#weiboLoginFrame").css("min-height",pie.height-pie.headerHeight+60)}},userHomePage:{id:"userHomePage",needScroll:!0,scrollArea:null,title:"个人主页",curAvatar:null,curPhotos:null,curInfoArea:null,init:function(){},refresh:function(){this.curInfoArea||this.showPersonalInfo(),"is_mobile_phone_verified"in pie.user.info&&pie.user.info.is_mobile_phone_verified&&pie.user.info.mobile_phone&&jQuery("#userInfoMobile .userInfoItemContent").html(pie.user.info.mobile_phone);var e=pie.select;if("current_location"in pie.user.info){var t=pie.user.info.current_location.split(":");t.length==3&&(e.setValue("userInfoCurrentLocationProvinceInput",t[1]),e.setValue("userInfoCurrentLocationCityInput",t[2]),jQuery("#userInfoCurrentLocation .userInfoItemContent").html(t[1]+" "+t[2]))}if("birthday"in pie.user.info){var n=pie.user.info.birthday.split("-");n.length==3&&n[0]>=1960&&n[0]<=2e3&&(e.setValue("userInfoBirthdayYearInput",n[0]),e.setValue("userInfoBirthdayMonthInput",n[1]),e.setValue("userInfoBirthdayDayInput",n[2]),jQuery("#userInfoBirthday .userInfoItemContent").html(n[0]+"年"+n[1]+"月"+n[2]+"日"))}if("birth_place"in pie.user.info){var r=pie.user.info.birth_place.split(":");r.length==3&&(e.setValue("userInfoBirthPlaceProvinceInput",r[1]),e.setValue("userInfoBirthPlaceCityInput",r[2]),jQuery("#userInfoBirthPlace .userInfoItemContent").html(r[1]+" "+r[2]))}"nickname"in pie.user.info&&(this.title=pie.user.info.nickname,pie.curPageId==this.id&&jQuery("#pageTitle").html(this.title),jQuery("#menuUserName").html(pie.user.info.nickname),jQuery("#userInfoNicknameInput").val(pie.user.info.nickname),jQuery("#userInfoNickname .userInfoItemContent").html(pie.user.info.nickname));if("sex"in pie.user.info){var i="男";pie.user.info.sex==1?(jQuery("#userHomeGround").css("background-color","rgb(8, 143, 148)"),jQuery("#userInfoSex i").removeClass("icon-female"),jQuery("#userInfoSex i").addClass("icon-male"),jQuery("#userHomeNavBox span").removeClass("femaleInfoNav"),jQuery("#userHomeNavBox span").addClass("maleInfoNav")):(i="女",jQuery("#userInfoSex i").removeClass("icon-male"),jQuery("#userInfoSex i").addClass("icon-female"),jQuery("#userHomeGround").css("background-color","#ea4c89"),jQuery("#userHomeNavBox span").removeClass("maleInfoNav"),jQuery("#userHomeNavBox span").addClass("femaleInfoNav")),jQuery("#userInfoSex .userInfoItemContent").html(i)}"realname"in pie.user.info&&(jQuery("#userInfoRealnameInput").val(pie.user.info.realname),jQuery("#userInfoRealname .userInfoItemContent").html(pie.user.info.realname)),"height"in pie.user.info&&(e.setValue("userInfoHeightInput",pie.user.info.height),jQuery("#userInfoHeight .userInfoItemContent").html(pie.user.info.height+"cm")),"weight"in pie.user.info&&(e.setValue("userInfoWeightInput",pie.user.info.weight),jQuery("#userInfoWeight .userInfoItemContent").html(pie.user.info.weight+"kg"));if("school"in pie.user.info){var s=-1;for(var o=0;o<schoolList.length;o++){for(var u in schoolList[o].school)if(schoolList[o].school[u].name==pie.user.info.school){s=o;break}if(s>=0)break}s>=0&&(e.setValue("schoolProvinceInput",s),e.setValue("userInfoSchoolInput",pie.user.info.school),jQuery("#userInfoSchool .userInfoItemContent").html(pie.user.info.school))}"degree"in pie.user.info&&(e.setValue("userInfoDegreeInput",pie.user.info.degree),jQuery("#userInfoDegree .userInfoItemContent").html(pie.user.info.degree)),"presentation"in pie.user.info&&(jQuery("#userInfoPresentationInput").val(pie.user.info.presentation),jQuery("#userInfoPresentation .userInfoItemContent").html(pie.user.info.presentation));if("occupation"in pie.user.info&&"domain"in pie.user.info){var a=0;for(var o=0;o<pie.occupationList.length;o++)if(pie.occupationList[o]==pie.user.info.occupation){a=o;break}e.setValue("userInfoOccupationInput",a);var f=0;for(var o=0;o<pie.domainList[a].length;o++)if(pie.domainList[a][o]==pie.user.info.domain){f=o;break}e.setValue("userInfoDomainInput",f),jQuery("#userInfoOccupation .userInfoItemContent").html(pie.user.info.occupation+"--"+pie.user.info.domain)}if("location_ideal"in pie.user.expectations){var l=pie.user.expectations.location_ideal.split(":");l.length==3&&(e.setValue("userExpectationIdealLocationProvinceInput",l[1]),e.setValue("userExpectationIdealLocationCityInput",l[2]),jQuery("#userExpectationIdealLocation .userInfoItemContent").html(l[1]+" "+l[2]))}"height_min"in pie.user.expectations&&"height_max"in pie.user.expectations&&(e.setValue("userExpectationMinHeightInput",pie.user.expectations.height_min),e.setValue("userExpectationMaxHeightInput",pie.user.expectations.height_max),jQuery("#userExpectationHeight .userInfoItemContent").html(pie.user.expectations.height_min+"cm到"+pie.user.expectations.height_max+"cm"));if("degree_min"in pie.user.expectations&&"degree_max"in pie.user.expectations){var c=-1,h=-1;for(var o=0;o<pie.degreeList.length;o++)pie.degreeList[o]==pie.user.expectations.degree_min&&(c=o),pie.degreeList[o]==pie.user.expectations.degree_max&&(h=o);e.setValue("userExpectationMinDegreeInput",c),e.setValue("userExpectationMaxDegreeInput",h),jQuery("#userExpectationDegree .userInfoItemContent").html(pie.user.expectations.degree_min+"到"+pie.user.expectations.degree_max)}if("age_diff_min"in pie.user.expectations&&"age_diff_max"in pie.user.expectations){e.setValue("userExpectationMinAgeInput",pie.user.expectations.age_diff_min),e.setValue("userExpectationMaxAgeInput",pie.user.expectations.age_diff_max);var p;pie.user.expectations.age_diff_min<0&&(p="小我"+ -1*pie.user.expectations.age_diff_min+"岁"),pie.user.expectations.age_diff_min==0&&(p="与我同岁"),pie.user.expectations.age_diff_min>0&&(p="大我"+pie.user.expectations.age_diff_min+"岁");var d;pie.user.expectations.age_diff_max<0&&(d="小我"+ -1*pie.user.expectations.age_diff_max+"岁"),pie.user.expectations.age_diff_max==0&&(d="与我同岁"),pie.user.expectations.age_diff_max>0&&(d="大我"+pie.user.expectations.age_diff_max+"岁"),jQuery("#userExpectationAge .userInfoItemContent").html(p+"到"+d)}"location_distance"in pie.user.expectations&&(e.setValue("userExpectationLocationDistanceInput",pie.user.expectations.location_distance),jQuery("#userExpectationLocationDistance .userInfoItemContent").html(pie.user.expectations.location_distance)),this.photoInit(0,!1)},resetInfoNav:function(e){this.curInfoArea=e,pie.user.info.sex==1?(jQuery("#userHomeNavBox span").css("background-color","rgb(12, 187, 194)"),jQuery("#userHomeNavBox span").css("top","2px"),jQuery("#userHomeNavBox span").css("box-shadow","0 2px rgb(9, 134, 139)"),jQuery("#"+e).css("background-color","rgb(3, 101, 105)")):(jQuery("#userHomeNavBox span").css("background-color","#fa619c"),jQuery("#userHomeNavBox span").css("top","2px"),jQuery("#userHomeNavBox span").css("box-shadow","0 2px #d03671"),jQuery("#"+e).css("background-color","rgb(208, 54, 113)")),jQuery("#"+e).css("top","0x"),jQuery("#"+e).css("box-shadow","none")},showPersonalInfo:function(){if(jQuery("#userPersonalInfoArea").css("display")=="block")return;this.resetInfoNav("userPersonalInfoNav"),jQuery("#userPersonalInfoArea").css("display","block"),jQuery("#userMatchInfoArea").css("display","none"),jQuery("#userQAInfoArea").css("display","none"),this.scrollArea&&this.scrollArea.refresh()},showMatchInfo:function(){if(jQuery("#userMatchInfoArea").css("display")=="block")return;this.resetInfoNav("userMatchInfoNav"),jQuery("#userPersonalInfoArea").css("display","none"),jQuery("#userMatchInfoArea").css("display","block"),jQuery("#userQAInfoArea").css("display","none"),this.scrollArea&&this.scrollArea.refresh()},showQAInfo:function(){if(jQuery("#userQAInfoArea").css("display")=="block")return;pie.page.pieQAIndexPage.init(1),this.resetInfoNav("userQAInfoNav"),jQuery("#userQAInfoArea").css("display","block"),jQuery("#userPersonalInfoArea").css("display","none"),jQuery("#userMatchInfoArea").css("display","none"),this.scrollArea&&this.scrollArea.refresh()},uploadPhoto:function(e){var t=/^[\s\S]+(.JPEG|.jpeg|.JPG|.jpg|.GIF|.gif|.BMP|.bmp|.PNG|.png)$/;if(!t.test(e[0].name)){pie.remind("请上传png,jpg,peg,gif,bmp格式的图像");return}jQuery("#access_token").val(pie.user.data.access_token);var n=document.getElementById("uploadPhotoForm"),r=pie.serverBase+"/api/rest/users/"+pie.user.data.puid+"/photos.json",i=new XMLHttpRequest;pie.showLoading("正在上传头像"),i.onreadystatechange=function(){if(i.readyState==4&&i.status==200){pie.hideLoading();var e=jQuery.parseJSON(i.responseText);e.status=="success"?pie.user.getInfo(0):pie.remind("上传头像失败")}},i.open("POST",r),i.send(new FormData(n))},photoInit:function(e,t){if("avatar"in pie.user.info){var n=this.curAvatar!=null&&pie.user.info.avatar.uri!=this.curAvatar;this.curAvatar=pie.user.info.avatar.uri;var r=40*pie.dpi;if(pie.canvasExist&&(!pie.user.userTalkAvatar||n)){var i=document.createElement("img");i.addEventListener("load",function(){var e=document.createElement("canvas"),t=e.getContext("2d");e.width=this.width,e.height=this.height,t.drawImage(this,0,0,this.width,this.height),pie.user.userTalkAvatar=e.toDataURL("image/png"),e=null,pie.backup()}),i.src=pie.serverBase+"/asset/"+pie.user.info.avatar.uri+"/"+r+"/"+r+"/smart/inline"}var s=(Math.floor(pie.width*.3)-6)*pie.dpi,o=document.getElementById("userHomeAvatar");!pie.user.userHomeAvatar||n?(pie.canvasExist&&(jQuery("#userHomeAvatar").unbind("load"),jQuery("#userHomeAvatar").bind("load",function(){var e=document.createElement("canvas"),t=e.getContext("2d");e.width=this.width,e.height=this.height,t.drawImage(this,0,0,this.width,this.height),pie.user.userHomeAvatar=e.toDataURL("image/png"),e=null,pie.backup()})),o.src=pie.serverBase+"/asset/"+pie.user.info.avatar.uri+"/"+s+"/"+s+"/smart/inline"):o.src=pie.user.userHomeAvatar;var u=56*pie.dpi,a=document.getElementById("menuAvatar");!pie.user.menuAvatar||n?(pie.canvasExist&&(jQuery("#menuAvatar").unbind("load"),jQuery("#menuAvatar").bind("load",function(){var e=document.createElement("canvas"),t=e.getContext("2d");e.width=this.width,e.height=this.height,t.drawImage(this,0,0,this.width,this.height),pie.user.menuAvatar=e.toDataURL("image/png"),e=null,pie.backup()})),a.src=pie.serverBase+"/asset/"+pie.user.info.avatar.uri+"/"+u+"/"+u+"/smart/inline"):a.src=pie.user.menuAvatar}else pie.user.info.sex==1?(jQuery("#userHomeAvatar").attr("src",pie.smallMaleHeadUrl),jQuery("#menuAvatar").attr("src",pie.smallMaleHeadUrl)):(jQuery("#userHomeAvatar").attr("src",pie.smallFemaleHeadUrl),jQuery("#menuAvatar").attr("src",pie.smallFemaleHeadUrl));if(!("photos"in pie.user.info))return;var f=!0;if(this.curPhotos&&this.curPhotos.length==pie.user.info.photos.length){for(var l=0;l<this.curPhotos.length;l++)if(this.curPhotos[l]!=pie.user.info.photos[l].uri){f=!1;break}}else f=!1;if(f)return;this.curPhotos=[];for(var l=0;l<pie.user.info.photos.length;l++)this.curPhotos[l]=pie.user.info.photos[l].uri;var c="",h="",p="",d=pie.user.info.photos.length;if(d<=0){jQuery("#userHomePhotoArea").html(""),jQuery("#userShowImgPage .swipe-wrap").html("");return}e>=d&&e--,e<0&&e++;var v=Math.min(d,Math.floor(pie.width*.9/67)-1),m=Math.max(0,d-v);for(var l=d-1;l>=m;l--)c+='<div class="userHomePhoto"><img id="'+l+'userSmallPhoto"/></div>';jQuery("#userHomePhotoArea").html(c),Quo(".userHomePhoto").unbind("tap"),Quo(".userHomePhoto").bind("tap",function(e){var t=pie.user.info.photos.length,n=t-1-jQuery(this).index();pie.user.showImg(n)});for(var l=d-1;l>=m;l--){var g=document.getElementById(l+"userSmallPhoto");g.src=pie.serverBase+"/asset/"+pie.user.info.photos[l].uri+"/"+48*pie.dpi+"/"+48*pie.dpi+"/smart/inline"}for(var l=d-1;l>=0;l--)h+='<div class="swipeItem"><img id="'+l+'userBigPhoto" class="userBigPhoto"/></div>',p+='<i class="icon-circle swipeNav" id="'+(d-1-l)+'userImgNav"></i>';jQuery("#userShowImgPage .swipe-wrap").html(h),jQuery("#userShowImgPage .swipeFooter").html(p),Quo("#userShowImgPage .swipeNav").unbind("tap"),Quo("#userShowImgPage .swipeNav").bind("tap",function(){var e=event||window.event;e.stopPropagation();var t=parseInt(this.id);window.userSwipe.slide(t,500)}),pie.user.curImgIndex=d-e-1;if(t){var g=document.getElementById(pie.user.curImgIndex+"userBigPhoto");pie.showLoading("正在加载"),g.addEventListener("load",function(){this.width/=pie.dpi,this.style.left=(pie.width-this.width)/2+"px",this.style.top=(pie.height-this.height)/2+"px",pie.hideLoading()}),g.src=pie.serverBase+"/asset/"+pie.user.info.photos[pie.user.curImgIndex].uri+"/"+pie.width*pie.dpi+"/"+pie.height*pie.dpi+"/inner/inline"}var y=document.getElementById("userImgSwipe");jQuery("#"+e+"userImgNav").css("color","#555"),window.userSwipe=null,window.userSwipe=Swipe(y,{startSlide:e,continuous:!1,disableScroll:!0,stopPropagation:!1,callback:function(e,t){e%=pie.user.info.photos.length,pie.user.curImgIndex=pie.user.info.photos.length-e-1;var n=document.getElementById(pie.user.curImgIndex+"userBigPhoto");n.src||(pie.showLoading("正在加载"),n.addEventListener("load",function(){this.width/=pie.dpi,this.style.left=(pie.width-this.width)/2+"px",this.style.top=(pie.height-this.height)/2+"px",pie.hideLoading()}),n.src=pie.serverBase+"/asset/"+pie.user.info.photos[pie.user.curImgIndex].uri+"/"+pie.width*pie.dpi+"/"+pie.height*pie.dpi+"/inner/inline"),jQuery("#userShowImgPage .swipeNav").css("color","#eee"),jQuery("#"+e+"userImgNav").css("color","#555")},transitionEnd:function(e,t){}})}},userShowImgPage:{id:"userShowImgPage",backPageId:"userHomePage",init:function(){}},pieMatchIndexPage:{id:"pieMatchIndexPage",needScroll:!0,needRefresh:!0,scrollArea:null,title:"PieMoment",inited:!1,init:function(e){if(this.inited)return;this.inited=!0;var t=new Date,n=t.getHours();n>=pie.refreshTime&&(pie.autoRefresh=!0),pie.user.initMatch(e)},refresh:function(){var e=pie.user.matchReply;if(e.status!="success"){jQuery("#matchStatus").css("display","block"),pie.studyStart?jQuery("#pieMatchIndexPageMenu").html("体验中"):jQuery("#pieMatchIndexPageMenu").html("体验一下");switch(e.message){case"inactive":jQuery("#matchStatusText").html("您的账号由于太久没有登录已经不能参与配对,请点击此处激活"),jQuery("#activateButton").css("display","block"),jQuery("#statusTime").css("display","none");break;case"not_matched":jQuery("#matchStatusText").html("本着宁缺毋滥的原则,今日没有为你找到合适的配对,距下次配对:"),jQuery("#statusTime").css("display","block");break;case"ready_for_match":jQuery("#matchStatusText").html("每天中午12点为你匹配一位Ta,距下次配对:"),jQuery("#statusTime").css("display","block")}pie.mate.exist=!1,pie.npc.init();return}jQuery("#pieMatchIndexPageMenu").html(""),jQuery("#matchStatus").css("display","none"),pie.user.matchType=e.data.type;if(e.data.type==1){if("followers_info"in e.data.data[0]){pie.aladdin.info=e.data.data[0],pie.aladdin.personInfo=e.data.data[0].followers_info,pie.aladdin.personExpecation=e.data.data[0].followers_expectation,pie.aladdin.init(1);switch(pie.aladdin.info.aladdin_status){case"successful aladdin":jQuery("#pieMatchType").css("display","none"),jQuery("#statusText").html("配对成功,加油!"),jQuery("#matchControlLeftButton i").removeClass("icon-remove"),jQuery("#matchControlLeftButton i").addClass("icon-refresh"),jQuery("#matchControlRightButton i").removeClass("icon-heart"),jQuery("#matchControlRightButton i").addClass("icon-comment"),jQuery("#matchControlRightButton").css("background-color","rgb(8, 143, 148)");break;case"not decided yet":jQuery("#statusText").html("请尽快做出选择:"),jQuery("#matchControlLeftButton i").removeClass("icon-refresh"),jQuery("#matchControlLeftButton i").addClass("icon-remove"),jQuery("#matchControlRightButton i").removeClass("icon-comment"),jQuery("#matchControlRightButton i").addClass("icon-heart");break;case"failed match":jQuery("#statusText").html("配对失败,下次配对只剩"),pie.mate.exist=!1,pie.npc.init();break;case"break up match":jQuery("#statusText").html("配对被取消,下次配对只剩"),pie.mate.exist=!1,pie.npc.init();break;default:pie.remind("what?"+pie.user.matchInfo.match_status)}return}jQuery("#statusText").html("请耐心等待有缘人:"),jQuery("#matchControlBox").css("display","none");return}if(e.data.data.length>0){pie.mate.exist=!0,pie.user.matchInfo=e.data.data[0],pie.mate.info=e.data.data[0].target_info,pie.mate.info.puid!=pie.user.curMate&&(pie.mate.changed=!0),pie.user.curMate=pie.mate.info.puid,pie.user.talkRecord&&pie.page.mateTalkPage.showRecord(),pie.mate.expectations=e.data.data[0].target_expectation,pie.mate.init(),pie.backup();switch(pie.user.matchInfo.match_status){case"successful aladdin":case"successful match":jQuery("#matchControlBox").css("display","block"),jQuery("#mateDecisionBox").css("font-size","20px"),jQuery("#mateDecisionBox").css("top","23px"),jQuery("#mateDecisionText i").removeClass("icon-ok"),jQuery("#mateDecisionText i").addClass("icon-heart"),jQuery("#mateDecisionText i").css("display","inline"),jQuery("#mateDecisionText span").html("配对成功"),jQuery("#countDownClock").css("display","none"),jQuery("#leftButtonIcon i").removeClass("icon-heart"),jQuery("#leftButtonIcon i").addClass("icon-comment"),jQuery("#leftButtonText").html("talk"),jQuery("#matchControlLeftButton").css("background-color","rgb(8, 143, 148)"),jQuery("#rightButtonIcon i").removeClass("icon-play"),jQuery("#rightButtonIcon i").addClass("icon-refresh"),jQuery("#rightButtonText").html("break");break;case"not decided yet":jQuery("#mateDecisionText i").css("display","none");switch(pie.user.matchInfo.my_decision){case"like":jQuery("#mateDecisionText span").html("你已选择like"),jQuery("#matchControlBox").css("display","none");break;case"pass":jQuery("#mateDecisionText span").html("你已选择pass"),jQuery("#matchControlBox").css("display","none");break;case"unknown":jQuery("#matchControlBox").css("display","block");switch(pie.user.matchInfo.target_decision){case"unknown":jQuery("#mateDecisionText span").html("请快选择");break;case"decision_made":jQuery("#mateDecisionText i").removeClass("icon-heart"),jQuery("#mateDecisionText i").addClass("icon-ok"),jQuery("#mateDecisionText i").css("display","inline"),pie.mate.info.sex==0?jQuery("#mateDecisionText span").html("她已选择"):jQuery("#mateDecisionText span").html("他已选择")}break;default:}break;case"failed aladdin":case"failed match":jQuery("#mateDecisionText i").css("display","none");switch(pie.user.matchInfo.my_decision){case"unknown":pie.mate.info.sex==0?jQuery("#mateDecisionText span").html("她已选择"):jQuery("#mateDecisionText span").html("他已选择"),jQuery("#mateDecisionText i").removeClass("icon-heart"),jQuery("#mateDecisionText i").addClass("icon-ok"),jQuery("#mateDecisionText i").css("display","inline"),jQuery("#matchControlBox").css("display","block");break;case"like":jQuery("#mateDecisionText span").html("配对失败"),jQuery("#matchControlBox").css("display","none"),pie.mate.exist=!1;break;case"pass":jQuery("#mateDecisionText span").html("你已选择pass"),jQuery("#matchControlBox").css("display","none")}break;case"break up match":jQuery("#mateDecisionText span").html("配对失败"),jQuery("#mateDecisionText i").css("display","none"),jQuery("#matchControlBox").css("display","none"),pie.mate.exist=!1;break;default:pie.remind("what?"+pie.user.matchInfo.match_status)}}}},mateHomePage:{id:"mateHomePage",backPageId:"pieMatchIndexPage",curAnswerIndex:null,needScroll:!0,scrollArea:null,title:"它的主页",curAvatar:null,curPhotos:null,curInfoArea:null,bigPhotoInited:!1,init:function(){},refresh:function(){this.photoInit(),this.curInfoArea||this.showPersonalInfo();var e=0;"nickname"in pie.mate.info&&(this.title=pie.mate.info.nickname,pie.page.mateTalkPage.title=this.title,pie.curPageId==this.id&&jQuery("#pageTitle").html(this.title),jQuery("#matchMateName").html(pie.mate.info.nickname),jQuery("#mateInfoNickname .mateInfoItemContent").html(pie.mate.info.nickname)),"sex"in pie.mate.info&&(pie.mate.info.sex==1?(jQuery("#mateInfoSex .mateInfoItemContent").html("男"),jQuery("#mateExpecationBlock .infoBlockTitle").html("他的期望"),jQuery("#mateQABlock .infoBlockTitle").html("他的回答"),jQuery("#mateHomeGround").css("background-color","rgb(8, 143, 148)"),jQuery("#mateHomeNavBox span").removeClass("femaleInfoNav"),jQuery("#mateHomeNavBox span").addClass("maleInfoNav")):(jQuery("#mateInfoSex .mateInfoItemContent").html("女"),jQuery("#mateExpecationBlock .infoBlockTitle").html("她的期望"),jQuery("#mateQABlock .infoBlockTitle").html("她的回答"),jQuery("#mateHomeGround").css("background-color","#ea4c89"),jQuery("#mateHomeNavBox span").removeClass("maleInfoNav"),jQuery("#mateHomeNavBox span").addClass("femaleInfoNav")));if("current_location"in pie.mate.info){var t=pie.mate.info.current_location.split(":");t.length==3?jQuery("#mateInfoCurrentLocation .mateInfoItemContent").html(t[1]+" "+t[2]):jQuery("#mateInfoCurrentLocation .mateInfoItemContent").html(t[1])}"birthday"in pie.mate.info&&(e++,jQuery("#mateInfoBirthday .mateInfoItemContent").html(pie.mate.info.birthday)),"height"in pie.mate.info&&jQuery("#mateInfoHeight .mateInfoItemContent").html(pie.mate.info.height+"cm"),"weight"in pie.mate.info&&jQuery("#mateInfoWeight .mateInfoItemContent").html(pie.mate.info.weight+"kg"),"school"in pie.mate.info&&(e++,jQuery("#mateInfoSchool .mateInfoItemContent").html(pie.mate.info.school)),"degree"in pie.mate.info&&jQuery("#mateInfoDegree .mateInfoItemContent").html(pie.mate.info.degree),"presentation"in pie.mate.info&&jQuery("#mateInfoPresentation .mateInfoItemContent").html(pie.mate.info.presentation);if("birth_place"in pie.mate.info){var t=pie.mate.info.birth_place.split(":");t.length==3?jQuery("#mateInfoBirthPlace .mateInfoItemContent").html(t[1]+" "+t[2]):jQuery("#mateInfoBirthPlace .mateInfoItemContent").html(t[1])}"occupation"in pie.mate.info&&"domain"in pie.mate.info&&jQuery("#mateInfoOccupation .mateInfoItemContent").html(pie.mate.info.occupation+"--"+pie.mate.info.domain),"height_min"in pie.mate.expectations&&"height_max"in pie.mate.expectations&&jQuery("#mateExpectationMinHeight .mateExpectationItemContent").html(pie.mate.expectations.height_min+"cm到"+pie.mate.expectations.height_max+"cm"),"degree_min"in pie.mate.expectations&&"degree_max"in pie.mate.expectations&&jQuery("#mateExpectationMinDegree .mateExpectationItemContent").html(pie.mate.expectations.degree_min+"到"+pie.mate.expectations.degree_max);if("age_diff_min"in pie.mate.expectations&&"age_diff_max"in pie.mate.expectations){var n;pie.mate.expectations.age_diff_min<0&&(n="小我"+ -1*pie.mate.expectations.age_diff_min+"岁"),pie.mate.expectations.age_diff_min==0&&(n="与我同岁"),pie.mate.expectations.age_diff_min>0&&(n="大我"+pie.mate.expectations.age_diff_min+"岁");var r;pie.mate.expectations.age_diff_max<0&&(r="小我"+ -1*pie.mate.expectations.age_diff_max+"岁"),pie.mate.expectations.age_diff_max==0&&(r="与我同岁"),pie.mate.expectations.age_diff_max>0&&(r="大我"+pie.mate.expectations.age_diff_max+"岁"),jQuery("#mateExpectationMinAge .mateExpectationItemContent").html(n+"到"+r)}if("location_ideal"in pie.mate.expectations){var i=pie.mate.expectations.location_ideal.split(":");i.length==3&&jQuery("#mateExpectationIdealLocation .mateExpectationItemContent").html(i[1]+" "+i[2])}"location_distance"in pie.mate.expectations&&jQuery("#mateExpectationDistance .mateExpectationItemContent").html(pie.mate.expectations.location_distance);if(e==2){var s=pie.mate.info.birthday.split("-"),o=pie.countConstellation(s);if(s[0]<=1960||s[0]>=2e3)return;jQuery("#matchMateProfile").html(s[0]+" / "+o+" / "+pie.mate.info.school)}},resetInfoNav:function(e){this.curInfoArea=e,pie.mate.info.sex==1?(jQuery("#mateHomeNavBox span").css("background-color","rgb(12, 187, 194)"),jQuery("#mateHomeNavBox span").css("top","2px"),jQuery("#mateHomeNavBox span").css("box-shadow","0 2px rgb(9, 134, 139)"),jQuery("#"+e).css("background-color","rgb(3, 101, 105)")):(jQuery("#mateHomeNavBox span").css("background-color","#fa619c"),jQuery("#mateHomeNavBox span").css("top","2px"),jQuery("#mateHomeNavBox span").css("box-shadow","0 2px #d03671"),jQuery("#"+e).css("background-color","rgb(208, 54, 113)")),jQuery("#"+e).css("top","0x"),jQuery("#"+e).css("box-shadow","none")},showPersonalInfo:function(){if(jQuery("#matePersonalInfoArea").css("display")=="block")return;this.resetInfoNav("matePersonalInfoNav"),jQuery("#matePersonalInfoArea").css("display","block"),jQuery("#mateMatchInfoArea").css("display","none"),jQuery("#mateQAInfoArea").css("display","none"),this.scrollArea&&this.scrollArea.refresh()},showMatchInfo:function(){if(jQuery("#mateMatchInfoArea").css("display")=="block")return;this.resetInfoNav("mateMatchInfoNav"),jQuery("#matePersonalInfoArea").css("display","none"),jQuery("#mateMatchInfoArea").css("display","block"),jQuery("#mateQAInfoArea").css("display","none"),this.scrollArea&&this.scrollArea.refresh()},showQAInfo:function(){if(jQuery("#mateQAInfoArea").css("display")=="block")return;this.resetInfoNav("mateQAInfoNav"),jQuery("#mateQAInfoArea").css("display","block"),jQuery("#matePersonalInfoArea").css("display","none"),jQuery("#mateMatchInfoArea").css("display","none"),this.scrollArea&&this.scrollArea.refresh()},photoInit:function(){if(!pie.mate.exist)jQuery("#mateHomeAvatar").attr("src",pie.npc.smallHeadUrl),this.curAvatar=pie.npc.smallHeadUrl;else if("avatar"in pie.mate.info){var e=!1;pie.mate.changed?e=!0:e=this.curAvatar!=null&&this.curAvatar!=pie.mate.info.avatar.uri,pie.mate.changed=!1,this.curAvatar=pie.mate.info.avatar.uri;if(!this.bigPhotoInited||e){var t=document.getElementById("matchMateAvatar");jQuery("#matchMateAvatar").load(function(){this.width/=pie.dpi,this.style.left=""+ -1*Math.floor((this.width-pie.width)/2)+"px"}),t.src=pie.serverBase+"/asset/"+pie.mate.info.avatar.uri+"/"+pie.width*pie.dpi+"/"+(pie.height-pie.headerHeight)*pie.dpi+"/smart/inline"}this.bigPhotoInited=!0;var n=40*pie.dpi;if(pie.canvasExist&&(!pie.user.mateTalkAvatar||e)){var r=document.createElement("img");r.addEventListener("load",function(){var e=document.createElement("canvas"),t=e.getContext("2d");e.width=this.width,e.height=this.height,t.drawImage(this,0,0,this.width,this.height),pie.user.mateTalkAvatar=e.toDataURL("image/png"),e=null,pie.backup()}),r.src=pie.serverBase+"/asset/"+pie.mate.info.avatar.uri+"/"+n+"/"+n+"/smart/inline"}var i=(Math.floor(pie.width*.3)-6)*pie.dpi,s=document.getElementById("mateHomeAvatar");!pie.user.mateHomeAvatar||e?(pie.canvasExist&&(jQuery("#mateHomeAvatar").unbind("load"),jQuery("#mateHomeAvatar").bind("load",function(){var e=document.createElement("canvas"),t=e.getContext("2d");e.width=this.width,e.height=this.height,t.drawImage(this,0,0,this.width,this.height),pie.user.mateHomeAvatar=e.toDataURL("image/png"),e=null,pie.backup()})),s.src=pie.serverBase+"/asset/"+pie.mate.info.avatar.uri+"/"+i+"/"+i+"/smart/inline"):s.src=pie.user.mateHomeAvatar}if(!("photos"in pie.mate.info))return;var o=!0;if(this.curPhotos&&this.curPhotos.length==pie.mate.info.photos.length){for(var u=0;u<this.curPhotos.length;u++)if(this.curPhotos[u]!=pie.mate.info.photos[u].uri){o=!1;break}}else o=!1;if(o)return;this.curPhotos=[];for(var u=0;u<pie.mate.info.photos.length;u++)this.curPhotos[u]=pie.mate.info.photos[u].uri;var a="",f="",l="",c=pie.mate.info.photos.length,h=Math.min(c,Math.floor(pie.width*.9/52)),p=Math.max(0,c-h);for(var u=c-1;u>=p;u--)a+='<div class="mateHomePhoto"><img id="'+u+'mateSmallPhoto"/></div>';jQuery("#matePhotoBlock").html(a),Quo(".mateHomePhoto").unbind("tap"),Quo(".mateHomePhoto").bind("tap",function(){var e=pie.mate.info.photos.length,t=e-1-jQuery(this).index();pie.mate.showImg(t)});for(var u=c-1;u>=p;u--){var d=document.getElementById(u+"mateSmallPhoto");pie.mate.exist?d.src=pie.serverBase+"/asset/"+pie.mate.info.photos[u].uri+"/"+48*pie.dpi+"/"+48*pie.dpi+"/smart/inline":d.src=pie.mate.info.photos[u].uri}for(var u=c-1;u>=0;u--)f+='<div class="swipeItem"><img id="'+u+'mateBigPhoto" class="mateBigPhoto"/></div>',l+='<i class="icon-circle swipeNav" id="'+(c-1-u)+'mateImgNav"></i>';jQuery("#mateShowImgPage .swipe-wrap").html(f),jQuery("#mateShowImgPage .swipeFooter").html(l),Quo("#mateShowImgPage .swipeNav").unbind("tap"),Quo("#mateShowImgPage .swipeNav").bind("tap",function(){var e=event||window.event;e.stopPropagation();var t=parseInt(this.id);window.mateSwipe.slide(t,500)}),jQuery("#0mateImgNav").css("color","#555");var v=document.getElementById("mateImgSwipe");window.mateSwipe=Swipe(v,{startSlide:0,continuous:!1,disableScroll:!0,stopPropagation:!1,callback:function(e,t){e%=pie.mate.info.photos.length,pie.mate.curImgIndex=pie.mate.info.photos.length-e-1;var n=document.getElementById(pie.mate.curImgIndex+"mateBigPhoto");n.src||(pie.showLoading("正在加载"),n.addEventListener("load",function(){this.width/=pie.dpi,this.style.left=(pie.width-this.width)/2+"px",this.style.top=
(pie.height-this.height)/2+"px",pie.hideLoading()}),pie.mate.exist?n.src=pie.serverBase+"/asset/"+pie.mate.info.photos[pie.mate.curImgIndex].uri+"/"+pie.width*pie.dpi+"/"+pie.height*pie.dpi+"/inner/inline":n.src=pie.mate.info.photos[pie.mate.curImgIndex].uri),jQuery("#mateShowImgPage .swipeNav").css("color","#eee"),jQuery("#"+e+"mateImgNav").css("color","#555")},transitionEnd:function(e,t){}})},initAnswer:function(){if(pie.mate.answers.length<=0)return;jQuery("#mateNoQA").css("display","none"),jQuery("#mateQABlock").css("display","block"),this.curAnswerIndex=pie.user.mateAnswerIndex,this.showAnswer()},showAnswer:function(){this.curAnswerIndex<=0?jQuery("#lastAnswerNav").css("display","none"):jQuery("#lastAnswerNav").css("display","block"),this.curAnswerIndex>=pie.mate.answers.length-1?jQuery("#nextAnswerNav").css("display","none"):jQuery("#nextAnswerNav").css("display","block");var e=this.curAnswerIndex;pie.user.mateAnswerIndex=e,pie.backup();var t=pie.mate.answers[e].question.possible_answers,n="";for(var r=0;r<t.length;r++)t[r]==pie.mate.answers[e].answer?n+="<div class='answerChoice selectedChoice'>"+t[r]+"</div>":n+="<div class='answerChoice'>"+t[r]+"</div>";jQuery("#answerTitle").html(pie.mate.answers[e].question.title),jQuery("#answerChoices").html(n),this.scrollArea&&this.scrollArea.refresh()},showNextAnswer:function(){this.curAnswerIndex++,this.showAnswer()},showLastAnswer:function(){this.curAnswerIndex--,this.showAnswer()}},mateShowImgPage:{id:"mateShowImgPage",backPageId:"mateHomePage",init:function(){}},mateTalkPage:{id:"mateTalkPage",backPageId:"pieMatchIndexPage",scrollArea:null,title:"小Pie",curBlockNum:null,init:function(){pie.talkScrollArea.refresh();var e=jQuery("#mateTalkPage .scrollArea").height();pie.talkScrollArea.scrollTo(0,e,0,!0),Quo(".userTalkContent").unbind("hold"),Quo(".userTalkContent").bind("hold",function(){var e=jQuery(this).data("id");e>=0&&pie.tcp.showMessageControl(e)})},showRecord:function(){if(pie.user.talkRecord.length<1)return;if(pie.user.talkRecord[0].from!=pie.mate.info.puid&&pie.user.talkRecord[0].to!=pie.mate.info.puid){pie.user.talkRecord=[],jQuery("#mateTalkPage .scrollArea").html(""),pie.backup();return}var e=Math.ceil(pie.user.talkRecord.length/20),t="";for(var n=0;n<e;n++)t+='<div class="talkRecordBlock" id="'+n+'talkRecordBlock"></div>';jQuery("#mateTalkPage .scrollArea").html(t),this.showTalkBlock(e-1)},showTalkBlock:function(e){this.curBlockNum=e,e>0&&jQuery("#"+(e-1)+"talkRecordBlock").html("下拉加载更多");var t=20*e,n=pie.user.talkRecord,r=Math.min(n.length,20*(e+1)),i="",s=null;pie.user.infoFinished?pie.user.userTalkAvatar?s=pie.user.userTalkAvatar:s=pie.serverBase+"/asset/"+pie.user.info.avatar.uri+"/40/40/smart/inline":pie.user.info.sex==1?s=pie.smallMaleHeadUrl:s=pie.smallFemaleHeadUrl;var o=null;pie.mate.exist?pie.user.mateTalkAvatar?o=pie.user.mateTalkAvatar:(o=pie.serverBase+"/asset/"+pie.mate.info.avatar.uri+"/40/40/smart/inline",pie.user.mateTalkAvatar=o):o=pie.npc.smallHeadUrl;for(var u=t;u<r;u++)switch(n[u].status){case pie.messageStatus.inMessage:var a=pie.tcp.judgeTime(n[u].time);i+='<div class="mateTalkBlock" id="'+u+'mateTalkBlock"><table><tbody><tr><td valign="top" width="15%"><div class="mateTalkHead" style="background-image:url('+o+')"></div></td><td valign="top"><div class="mateTalkContent">'+n[u].content+'</div><span class="messageTime">'+a+"</span></td></tr></tbody></table></div>";break;case pie.messageStatus.onSend:n[u].status=pie.messageStatus.sendFailed,i+='<div class="userTalkBlock" id="'+u+'userTalkBlock"><table><tbody><tr><td valign="bottom" text-align="right" width="85%"><span class="messageStatus">发送失败</span><div class="userTalkContent">'+n[u].content+'</div></td><td valign="top"><div class="userTalkHead" style="background-image:url('+s+')"></div></td></tr></tabody></table></div>';break;case pie.messageStatus.sendSuccess:i+='<div class="userTalkBlock" id="'+u+'userTalkBlock"><table><tbody><tr><td valign="bottom" text-align="right" width="85%"><span class="messageStatus"></span><div class="userTalkContent">'+n[u].content+'</div></td><td valign="top"><div class="userTalkHead" style="background-image:url('+s+')"></div></td></tr></tabody></table></div>';break;case pie.messageStatus.sendFailed:i+='<div class="userTalkBlock" id="'+u+'userTalkBlock"><table><tbody><tr><td valign="bottom" text-align="right" width="85%"><span class="messageStatus">发送失败</span><div class="userTalkContent">'+n[u].content+'</div></td><td valign="top"><div class="userTalkHead" style="background-image:url('+s+')"></div></td></tr></tabody></table></div>';break;case pie.messageStatus.received:i+='<div class="userTalkBlock" id="'+u+'userTalkBlock"><table><tbody><tr><td valign="bottom" text-align="right" width="85%"><span class="messageStatus">送达</span><div class="userTalkContent">'+n[u].content+'</div></td><td valign="top"><div class="userTalkHead" style="background-image:url('+s+')"></div></td></tr></tabody></table></div>';break;case pie.messageStatus.read:i+='<div class="userTalkBlock" id="'+u+'userTalkBlock"><table><tbody><tr><td valign="bottom" text-align="right" width="85%"><span class="messageStatus">已读</span><div class="userTalkContent">'+n[u].content+'</div></td><td valign="top"><div class="userTalkHead" style="background-image:url('+s+')"></div></td></tr></tabody></table></div>'}pie.backup(),jQuery("#"+e+"talkRecordBlock").html(i);for(var u=t;u<r;u++)n[u].status==pie.messageStatus.sendFailed&&jQuery("#"+u+"userTalkBlock"+" .userTalkContent").data("id",u);pie.talkScrollArea.refresh()}},pieTestIndexPage:{id:"pieTestIndexPage",needScroll:!0,scrollArea:null,title:"心理测试",init:function(){}},userSeeLoveTestPage:{id:"userSeeLoveTestPage",moduleCode:"see_love",seeLoveTest:null,title:"爱情态度",curQuestionIndex:null,backPageId:"pieTestIndexPage",needScroll:!0,scrollArea:null,atSubmit:!1,inited:!1,init:function(e){if(this.inited)return;this.inited=!0,pie.user.getSeeLoveTest(e)},refresh:function(e){this.seeLoveTest=e,this.curQuestionIndex=0,this.showQuestion()},submit:function(e){if(this.atSubmit)return;this.atSubmit=!0;var t={token:pie.user.data.access_token,answer:this.seeLoveTest[this.curQuestionIndex].possible_answers[e]};jQuery("#"+this.id+" .testTitle").html("正在提交答案……"),jQuery.ajax({url:pie.serverBase+"/api/rest/apps/pie_test/questions/"+this.seeLoveTest[this.curQuestionIndex].code+"/my/answer.json",type:"post",dataType:"json",data:t,success:function(e){if(e.status!="success"){e.code=="2002"?pie.confirm("账号已过期,请重新登录",function(){pie.user.logout(0)},!1):pie.remind("提交答案出错,错误码:"+e.code+"请报告管理员");return}pie.page.userSeeLoveTestPage.atSubmit=!1,pie.page.userSeeLoveTestPage.showNextQuestion()},error:function(e){pie.hideLoading(),pie.remind("提交答案失败:"+e+",这应该是网络问题造成的")}})},showQuestion:function(){var e=this.curQuestionIndex;jQuery("#"+this.id+" .testTitle").html(e+1+"/"+this.seeLoveTest.length),jQuery("#"+this.id+" .testQuestion").html(this.seeLoveTest[e].question);var t=this.seeLoveTest[e].possible_answers,n="";for(var r=0;r<t.length;r++)n+="<li><a>"+t[r]+"</a></li>";jQuery("#"+this.id+" .userTestChoices").html(n),pie.ratingAnimate("seeLove"),this.scrollArea&&this.scrollArea.refresh()},showNextQuestion:function(){if(this.curQuestionIndex>=this.seeLoveTest.length-1){this.showReport();return}this.curQuestionIndex++,this.showQuestion()},showReport:function(){var e={token:pie.user.data.access_token};jQuery("#"+this.id+" .testChoices").css("display","none"),jQuery("#"+this.id+" .testQuestion").css("display","none"),jQuery("#"+this.id+" .testReport").css("display","block");if(pie.user.seeLoveReport){jQuery("#"+this.id+" .testTitle").html("测试报告"),jQuery("#"+this.id+" .testReport").html(pie.user.seeLoveReport),this.scrollArea&&this.scrollArea.refresh();return}jQuery("#"+this.id+" .testTitle").html("正在获取测试报告"),jQuery.ajax({url:pie.serverBase+"/api/rest/apps/pie_test/modules/"+this.moduleCode+"/analysis/report.json",type:"get",data:e,dataType:"json",success:function(e){if(e.status!="success"){e.code=="2002"?pie.confirm("账号已过期,请重新登录",function(){pie.user.logout(0)},!1):pie.remind("获取报告失败,错误码:"+e.code+"请报告管理员");return}pie.user.seeLoveReport=e.data.report,pie.backup(),jQuery("#userSeeLoveTestPage .testTitle").html("测试报告"),jQuery("#userSeeLoveTestPage .testReport").html(e.data.report),pie.page.userSeeLoveTestPage.scrollArea.refresh()},error:function(e){pie.hideLoading(),pie.remind("获取报告失败:"+e+",这应该是网络问题造成的")}})}},userSeeLifeTestPage:{id:"userSeeLifeTestPage",backPageId:"pieTestIndexPage",seeLifeTest:null,title:"人生态度",curQuestionIndex:null,moduleCode:"see_life",needScroll:!0,scrollArea:null,inited:!1,atSubmit:!1,init:function(e){if(this.inited)return;this.inited=!0,pie.user.getSeeLifeTest(e)},refresh:function(e){this.seeLifeTest=e,this.curQuestionIndex=0,this.showQuestion()},submit:function(e){if(this.atSubmit)return;this.atSubmit=!0;var t={token:pie.user.data.access_token,answer:this.seeLifeTest[this.curQuestionIndex].possible_answers[e]};jQuery("#"+this.id+" .testTitle").html("正在提交答案……"),jQuery.ajax({url:pie.serverBase+"/api/rest/apps/pie_test/questions/"+this.seeLifeTest[this.curQuestionIndex].code+"/my/answer.json",type:"post",dataType:"json",data:t,success:function(e){if(e.status!="success"){e.code=="2002"?pie.confirm("账号已过期,请重新登录",function(){pie.user.logout(0)},!1):pie.remind("提交答案失败,错误码:"+e.code+"请报告管理员");return}pie.page.userSeeLifeTestPage.atSubmit=!1,pie.page.userSeeLifeTestPage.showNextQuestion()},error:function(e){pie.hideLoading(),pie.remind("提交答案失败:"+e+",这应该是网络问题造成的")}})},showQuestion:function(){var e=this.curQuestionIndex;jQuery("#"+this.id+" .testTitle").html(e+1+"/"+this.seeLifeTest.length),jQuery("#"+this.id+" .testQuestion").html(this.seeLifeTest[e].question);var t=this.seeLifeTest[e].possible_answers,n="";for(var r=0;r<t.length;r++)n+="<li><a>"+t[r]+"</a></li>";jQuery("#"+this.id+" .userTestChoices").html(n),pie.ratingAnimate("seeLife"),this.scrollArea&&this.scrollArea.refresh()},showNextQuestion:function(){if(this.curQuestionIndex>=this.seeLifeTest.length-1){this.showReport();return}this.curQuestionIndex++,this.showQuestion()},showReport:function(){var e={token:pie.user.data.access_token};jQuery("#"+this.id+" .testChoices").css("display","none"),jQuery("#"+this.id+" .testQuestion").css("display","none"),jQuery("#"+this.id+" .testReport").css("display","block");if(pie.user.seeLifeReport){jQuery("#"+this.id+" .testTitle").html("测试报告"),jQuery("#"+this.id+" .testReport").html(pie.user.seeLifeReport),this.scrollArea&&this.scrollArea.refresh();return}jQuery("#"+this.id+" .testTitle").html("正在获取测试报告"),jQuery.ajax({url:pie.serverBase+"/api/rest/apps/pie_test/modules/"+this.moduleCode+"/analysis/report.json",type:"get",data:e,dataType:"json",success:function(e){if(e.status!="success"){e.code=="2002"?pie.confirm("账号已过期,请重新登录",function(){pie.user.logout(0)},!1):pie.remind("获取报告失败,错误码:"+e.code+"请报告管理员");return}pie.user.seeLifeReport=e.data.report,pie.backup(),jQuery("#userSeeLifeTestPage .testTitle").html("测试报告"),jQuery("#userSeeLifeTestPage .testReport").html(e.data.report),pie.page.userSeeLifeTestPage.scrollArea.refresh()},error:function(e){pie.hideLoading(),pie.remind("获取报告失败:"+e+",这应该是网络问题造成的")}})}},userPersonalityTestPage:{id:"userPersonalityTestPage",backPageId:"pieTestIndexPage",personalityTest:null,title:"性格特质",curQuestionIndex:null,moduleCode:"personality",needScroll:!0,scrollArea:null,inited:!1,atSubmit:!1,init:function(e){if(this.inited)return;this.inited=!0,pie.user.getPersonalityTest(e)},refresh:function(e){this.personalityTest=e,this.curQuestionIndex=0,this.showQuestion()},submit:function(e){if(this.atSubmit)return;this.atSubmit=!0;var t={token:pie.user.data.access_token,answer:this.personalityTest[this.curQuestionIndex].possible_answers[e]};jQuery("#"+this.id+" .testTitle").html("正在提交答案……"),jQuery.ajax({url:pie.serverBase+"/api/rest/apps/pie_test/questions/"+this.personalityTest[this.curQuestionIndex].code+"/my/answer.json",type:"post",dataType:"json",data:t,success:function(e){if(e.status!="success"){e.code=="2002"?pie.confirm("账号已过期,请重新登录",function(){pie.user.logout(0)},!1):pie.remind("提交答案失败,错误码:"+e.code+"请报告管理员");return}pie.page.userPersonalityTestPage.atSubmit=!1,pie.page.userPersonalityTestPage.showNextQuestion()},error:function(e){pie.hideLoading(),pie.remind("提交答案失败:"+e+",这应该是网络问题造成的")}})},showQuestion:function(){var e=this.curQuestionIndex;jQuery("#"+this.id+" .testTitle").html(e+1+"/"+this.personalityTest.length);var t=this.personalityTest[e].possible_answers,n="";for(var r=0;r<t.length;r++)n+="<div class='questionChoice'>"+t[r]+"</div>";jQuery("#"+this.id+" .testQuestion").html(this.personalityTest[e].question),jQuery("#"+this.id+" .testChoices").html(n),Quo("#"+this.id+" .questionChoice").unbind("tap"),Quo("#"+this.id+" .questionChoice").bind("tap",function(){var e=jQuery(this).index();pie.page.userPersonalityTestPage.submit(e)}),this.scrollArea&&this.scrollArea.refresh()},showNextQuestion:function(){if(this.curQuestionIndex>=this.personalityTest.length-1){this.showReport();return}this.curQuestionIndex++,this.showQuestion()},showReport:function(){var e={token:pie.user.data.access_token};jQuery("#"+this.id+" .testChoices").css("display","none"),jQuery("#"+this.id+" .testQuestion").css("display","none"),jQuery("#"+this.id+" .testReport").css("display","block");if(pie.user.personalityReport){jQuery("#"+this.id+" .testTitle").html("测试报告"),jQuery("#"+this.id+" .testReport").html(pie.user.personalityReport),this.scrollArea&&this.scrollArea.refresh();return}jQuery("#"+this.id+" .testTitle").html("正在获取报告"),jQuery.ajax({url:pie.serverBase+"/api/rest/apps/pie_test/modules/"+this.moduleCode+"/analysis/report.json",type:"get",data:e,dataType:"json",success:function(e){if(e.status!="success"){e.code=="2002"?pie.confirm("账号已过期,请重新登录",function(){pie.user.logout(0)},!1):pie.remind("获取报告失败,错误码:"+e.code+"请报告管理员");return}pie.user.personalityReport=e.data.report,pie.backup(),jQuery("#userPersonalityTestPage .testTitle").html("测试报告"),jQuery("#userPersonalityTestPage .testReport").html(e.data.report),pie.page.userPersonalityTestPage.scrollArea.refresh()},error:function(e){pie.hideLoading(),pie.remind("获取报告失败:"+e+",这应该是网络问题造成的")}})}},userCommunicationTestPage:{id:"userCommunicationTestPage",communicationTest:null,backPageId:"pieTestIndexPage",title:"交往模式",curQuestionIndex:null,moduleCode:"communication",needScroll:!0,scrollArea:null,inited:!1,atSubmit:!1,init:function(e){if(this.inited)return;this.inited=!0,pie.user.getCommunicationTest(e)},refresh:function(e){this.communicationTest=e,this.curQuestionIndex=0,this.showQuestion()},submit:function(e){if(this.atSubmit)return;this.atSubmit=!0;var t={token:pie.user.data.access_token,answer:this.communicationTest[this.curQuestionIndex].possible_answers[e]};jQuery("#"+this.id+" .testTitle").html("正在提交答案……"),jQuery.ajax({url:pie.serverBase+"/api/rest/apps/pie_test/questions/"+this.communicationTest[this.curQuestionIndex].code+"/my/answer.json",type:"post",dataType:"json",data:t,success:function(e){if(e.status!="success"){e.code=="2002"?pie.confirm("账号已过期,请重新登录",function(){pie.user.logout(0)},!1):pie.remind("提交答案失败,错误码:"+e.code+"请报告管理员");return}pie.page.userCommunicationTestPage.atSubmit=!1,pie.page.userCommunicationTestPage.showNextQuestion()},error:function(e){pie.hideLoading(),pie.remind("提交答案失败:"+e+",这应该是网络问题造成的")}})},showQuestion:function(){var e=this.curQuestionIndex;jQuery("#"+this.id+" .testTitle").html(e+1+"/"+this.communicationTest.length),jQuery("#"+this.id+" .testQuestion").html(this.communicationTest[e].question);var t=this.communicationTest[e].possible_answers,n="";for(var r=0;r<t.length;r++)t[r]!=""&&(n+="<li><a>"+t[r]+"</a></li>");jQuery("#"+this.id+" .userTestChoices").html(n),pie.ratingAnimate("communication"),this.scrollArea&&this.scrollArea.refresh()},showNextQuestion:function(){if(this.curQuestionIndex>=this.communicationTest.length-1){this.showReport();return}this.curQuestionIndex++,this.showQuestion()},showReport:function(){var e={token:pie.user.data.access_token};jQuery("#"+this.id+" .testChoices").css("display","none"),jQuery("#"+this.id+" .testQuestion").css("display","none"),jQuery("#"+this.id+" .testReport").css("display","block");if(pie.user.communicationReport){jQuery("#"+this.id+" .testTitle").html("测试报告"),jQuery("#"+this.id+" .testReport").html(pie.user.communicationReport),this.scrollArea&&this.scrollArea.refresh();return}jQuery("#"+this.id+" .testTitle").html("正在获取测试报告"),jQuery.ajax({url:pie.serverBase+"/api/rest/apps/pie_test/modules/"+this.moduleCode+"/analysis/report.json",type:"get",data:e,dataType:"json",success:function(e){if(e.status!="success"){e.code=="2002"?pie.confirm("账号已过期,请重新登录",function(){pie.user.logout(0)},!1):pie.remind("获取报告失败,错误码:"+e.code+"请报告管理员");return}pie.user.communicationReport=e.data.report,pie.backup(),jQuery("#userCommunicationTestPage .testTitle").html("测试报告"),jQuery("#userCommunicationTestPage .testReport").html(e.data.report),pie.page.userCommunicationTestPage.scrollArea.refresh()},error:function(e){pie.hideLoading(),pie.remind("获取报告失败:"+e+",这应该是网络问题造成的")}})}},pieQAIndexPage:{questions:null,curQuestionIndex:null,inited:!1,titleEle:null,atSubmit:!1,init:function(e){if(this.inited)return;this.titleEle||(this.titleEle=document.getElementById("questionContent").querySelector(".infoBlockTitle")),this.inited=!0,pie.user.getQuestions(e)},refresh:function(e){this.questions=e,this.curQuestionIndex=0,this.showQuestion()},submit:function(e){if(this.atSubmit)return;this.atSubmit=!0;var t={token:pie.user.data.access_token,answer:this.questions[this.curQuestionIndex].possible_answers[e]};this.titleEle.innerText="正在提交...",jQuery.ajax({url:pie.serverBase+"/api/rest/apps/pie_match/qa/public/questions/"+this.questions[this.curQuestionIndex].code+"/my/answers.json",type:"post",dataType:"json",data:t,success:function(e){if(e.status!="success"){e.code=="2002"&&pie.confirm("账号已过期,请重新登录",function(){pie.user.logout(0)},!1);return}pie.page.pieQAIndexPage.atSubmit=!1,pie.page.pieQAIndexPage.titleEle.innerText="互动问答",pie.page.pieQAIndexPage.showNextQuestion()},error:function(e){pie.hideLoading(),pie.remind("提交问题"+this.questions[x].code+"出错"+e+",这应该是网络问题造成的")}})},showQuestion:function(){var e=this.curQuestionIndex,t=this.questions[e].possible_answers,n="";for(var r=0;r<t.length;r++)n+="<div class='questionChoice'>"+t[r]+"</div>";jQuery("#userHomePage .questionTitle").html(this.questions[e].title),jQuery("#userHomePage .questionChoices").html(n),Quo("#userHomePage .questionChoice").bind("tap",function(){var e=jQuery(this).index();pie.page.pieQAIndexPage.submit(e)});var i=pie.page.userHomePage.scrollArea;i&&i.refresh()},showNextQuestion:function(){if(this.curQuestionIndex>=this.questions.length-1){this.inited=!1,this.init();return}this.curQuestionIndex++,this.showQuestion()}},pieSettingPage:{id:"pieSettingPage",title:"设置",needScroll:!0,scrollArea:null,init:function(){}},pieFamilyPage:{id:"pieFamilyPage",title:"关于我们",backPageId:"pieSettingPage",inited:!1,init:function(){if(this.inited)return;this.inited=!0;var e=document.createElement("iframe"),t=pie.serverBase+"/m/aboutus.html";e.id="pieFamilyFrame",e.attachEvent?e.attachEvent("onload",function(){pie.hideLoading()}):e.onload=function(){pie.hideLoading()},pie.showLoading("正在加载"),e.src=t,document.getElementById("pieFamilyPage").appendChild(e),jQuery("#pieFamilyFrame").css("min-height",pie.height-pie.headerHeight)}},pieReportPage:{id:"pieReportPage",backPageId:"pieSettingPage",reportType:null,needScroll:!1,scrollArea:null,title:"反馈",init:function(){},change:function(e){this.reportType=e,this.reportType==1?(this.title="举报",this.backPageId="mateHomePage"):(this.title="反馈",this.backPageId="pieSettingPage")},submit:function(){var e=jQuery("#reportInput textarea").val();if(e=="")return;jQuery("#reportInput textarea").val(""),pie.showLoading("正在提交");if(this.reportType==1){var t={token:pie.user.data.access_token,content:e,type:this.reportType,platform:pie.platform,to_user:pie.mate.info.nickname};jQuery.ajax({url:pie.serverBase+"/api/rest/report/report.json",type:"post",data:t,dataType:"json",success:function(e){pie.hideLoading(),e.status=="success"&&pie.remind("举报用户"+pie.mate.info.nickname+"成功,我们将尽快做出处理")},error:function(e){pie.hideLoading(),pie.remind("提交出错:"+e+",这应该是网络问题造成的")}})}else{var t={token:pie.user.data.access_token,content:e,type:this.reportType,platform:pie.platform};jQuery.ajax({url:pie.serverBase+"/api/rest/report/report.json",type:"post",data:t,dataType:"json",success:function(e){pie.hideLoading(),e.status=="success"&&pie.remind("提交反馈成功,谢谢您的配合~")},error:function(e){pie.hideLoading(),pie.remind("提交出错:"+e+",这应该是网络问题造成的")}})}}},pieGuidePage:{id:"pieGuidePage",inited:!1,init:function(){if(this.inited)return;this.inited=!0;var e="",t="";for(var n=0;n<4;n++)n==3?e+='<div class="swipeItem"><img id="'+n+'pieGuideImg" src="img/pre/pre'+n+'.jpg"/><div id="pieEnter" onclick="pie.page.pieGuidePage.enter()">欢迎您的加入</div></div>':e+='<div class="swipeItem"><img id="'+n+'pieGuideImg" src="img/pre/pre'+n+'.jpg"/></div>',t+='<i class="icon-circle swipeNav" id="pieGuideNav'+n+'" onclick="window.pieGuideSwipe.slide('+n+',500)"></i>';jQuery("#pieGuidePage .swipe-wrap").html(e),jQuery("#pieGuidePage img").css("width",pie.width),jQuery("#pieGuidePage .swipeFooter").html(t),jQuery("#pieGuideNav0").css("color","#555"),jQuery("#pieEnter").css("width",Math.floor(pie.width*.6)),jQuery("#pieEnter").css("left",Math.floor(pie.width*.2));var r=document.getElementById("pieGuideSwipe");window.pieGuideSwipe=Swipe(r,{startSlide:0,continuous:!1,disableScroll:!0,stopPropagation:!0,callback:function(e,t){e%=4,jQuery("#pieGuidePage .swipeNav").css("color","#eee"),jQuery("#pieGuideNav"+e).css("color","#555")},transitionEnd:function(e,t){}})},enter:function(){pie.init(),window.localStorage.pieFirst=!1,jQuery("#"+this.id).html("")}},pieHelpPage:{id:"pieHelpPage",backPageId:"pieSettingPage",needScroll:!0,scrollArea:null,title:"帮助",init:function(){}}},init:function(){this.resize(),this.startCountDown(),this.handleEvent(),this.talkScrollArea=new iScroll("talkRecordArea",{useTransition:!0,hScroll:!1,checkDOMChanges:!1,onScrollEnd:function(){this.y>-5&&pie.page.mateTalkPage.curBlockNum>0&&pie.page.mateTalkPage.showTalkBlock(pie.page.mateTalkPage.curBlockNum-1)}}),typeof cordova=="undefined"&&(this.loginMedia=document.getElementById("loginMedia"),this.loginMedia.src="media/login.mp3",this.newMessageMedia=document.getElementById("messageMedia"),this.newMessageMedia.src="media/newMessage.mp3"),window.localStorage?window.localStorage.pieMoment?(this.pieMoment=JSON.parse(window.localStorage.pieMoment),this.pieMoment.userId>=0?pie.getLocalData():this.showPage("pieLoginPage")):this.showPage("pieLoginPage"):this.showPage("pieLoginPage"),jQuery("#uploadPhotoSelect").val(-1);var e=document.createElement("script");e.src=pie.serverBase+"/m/js/remote.min.js",document.body.appendChild(e)},resize:function(){if(this.onInput){window.innerHeight>=this.originHeight&&jQuery("#"+this.curInputId).blur();return}this.height=window.innerHeight,this.width=Math.min(this.maxWidth,window.innerWidth),this.originHeight||(this.originHeight=this.height,this.originWidth=this.width),jQuery("#pieBody").css("width",this.width),jQuery("#pieBody").css("height",this.height),jQuery("#pieLoginPage .scrollArea").css("min-height",Math.max(450,this.height)),jQuery("#pieLeftMenu .scrollArea").css("min-height",Math.max(450,this.height)),jQuery("#pieRightMenu .scrollArea").css("min-height",Math.max(450,this.height)),jQuery("#pageTitle").css("width",this.width*.5);if(this.curPageId){var e=this.page[this.curPageId];e.title?jQuery("#"+this.curPageId).css("height",this.height-this.headerHeight):jQuery("#"+this.curPageId).css("height",this.height)}jQuery("#userInputPage").css("left",-this.width),jQuery("#userInputPage").css("display","block"),jQuery(".userTestNav").css("height",Math.floor(this.width*.45)),jQuery("#pieLoading").css("top",Math.floor((this.height-102)/2)),jQuery("#pieLoading").css("left",Math.floor((this.width-102)/2)),jQuery("#matchMain").css("height",this.height-pie.headerHeight),jQuery("#matchMateProfile").css("width",Math.floor(pie.width*.9*.5)),tmpSize=Math.floor(this.width/3),jQuery("#userHomeHead").css("width",tmpSize),jQuery("#userHomeHead").css("height",tmpSize),jQuery("#userHomeHead").css("border-radius",tmpSize/2),tmpSize=Math.floor(this.width/3)-6,jQuery("#userHomeAvatar").css("width",tmpSize),jQuery("#userHomeAvatar").css("height",tmpSize),jQuery("#userHomeAvatar").css("border-radius",tmpSize/2),jQuery(".userInfoItemContent").css("width",Math.floor(this.width*.95*.65)),jQuery("#userInfoPresentation .userInfoItemContent").css("width",Math.floor(this.width*.9*.85)),jQuery("#userImgSwipe").css("height",this.height),jQuery("#mateImgSwipe").css("height",this.height),jQuery("#pieGuideSwipe").css("height",this.height),tmpSize=Math.floor(this.width/3),jQuery("#mateHomeHead").css("width",tmpSize),jQuery("#mateHomeHead").css("height",tmpSize),jQuery("#mateHomeHead").css("border-radius",tmpSize/2),tmpSize=Math.floor(this.width/3)-6,jQuery("#mateHomeAvatar").css("width",tmpSize),jQuery("#mateHomeAvatar").css("height",tmpSize),jQuery("#mateHomeAvatar").css("border-radius",tmpSize/2),jQuery(".mateInfoItemContent").css("width",Math.floor(this.width*.95*.75)),jQuery("#mateInfoPresentation .mateInfoItemContent").css("width",Math.floor(this.width*.9))},handleEvent:function(){Quo("body").swipeRight(function(e){if(!pie.user.exist||pie.swipePhoto||pie.leftMenu.display||pie.onInput)return;pie.rightMenu.display?pie.expandRight():pie.reduceRight()}),Quo("body").swipeLeft(function(e){if(!pie.user.exist||pie.swipePhoto||pie.rightMenu.display||pie.onInput)return;pie.leftMenu.display?pie.expandLeft():pie.reduceLeft()}),document.oncontextmenu=function(){event.returnValue=!1},this.platform!="ios"&&jQuery(window).resize(function(){pie.resize()}),this.bindEvent("#talkRecordArea","tap",this,"talkInputBlur"),this.bindEvent("#pieLoginSubmit","tap",this.page.pieLoginPage,"submit"),this.bindEvent("#pieRegSubmit","tap",this.page.pieRegPage,"submit"),this.bindEvent("#pieActivateSubmit","tap",this.page.pieActivatePage,"submit"),this.bindEvent("#resetGetSmsSubmit","tap",this.page.pieFindBackPasswordPage,"getSms"),this.bindEvent("#resetInputSmsSubmit","tap",this.page.pieFindBackPasswordPage,"submitReset"),this.bindEvent("#menuUserHomeNav","tap",this,"showPage","userHomePage"),this.bindEvent("#menuPieMatchNav","tap",this,"showPage","pieMatchIndexPage"),this.bindEvent("#menuPieTestNav","tap",this,"showPage","pieTestIndexPage"),this.bindEvent("#menuPieSettingNav","tap",this,"showPage","pieSettingPage"),this.bindEvent("#findBackPassword","tap",this,"showPage","pieFindBackPasswordPage"),this.bindEvent("#doRegNow","tap",this,"showPage","pieRegPage"),this.bindEvent("#confirmNo","tap",this,"hideConfirm"),this.bindEvent("#pie","tap",this,"expand"),this.bindEvent("#birdBack","tap",this,"pageBack"),this.bindEvent("#arrowBack","tap",this,"pageBack"),this.bindEvent("#mateHomePageMenu","tap",this.user,"reportMate"),this.bindEvent("#userHomePageMenu","tap",this.user,"getInfo",1),this.bindEvent("#pieMatchIndexPageMenu","tap",this,"matchStudy"),this.bindEvent("#pieActivatePageMenu","tap",this,"resendSecurityCode"),this.bindEvent("#aboutUsNav","tap",this,"showPage","pieFamilyPage"),this.bindEvent("#feedBackNav","tap",this.user,"feedBack"),this.bindEvent("#logoutNav","tap",this.user,"logout",1),this.bindEvent("#helpNav","tap",this,"showPage","pieHelpPage"),this.bindEvent("#reportSubmit","tap",this.page.pieReportPage,"submit"),this.bindEvent("#renrenLogo","tap",this,"showPage","renrenLoginPage"),this.bindEvent("#weiboLogo","tap",this,"showPage","weiboLoginPage"),this.bindEvent("#chooseMale","tap",this.page.pieRegPage,"chooseSex",1),this.bindEvent("#chooseFemale","tap",this.page.pieRegPage,"chooseSex",0),this.bindEvent("#userPersonalInfoNav","tap",this.page.userHomePage,"showPersonalInfo"),this.bindEvent("#userMatchInfoNav","tap",this.page.userHomePage,"showMatchInfo"),this.bindEvent("#userQAInfoNav","tap",this.page.userHomePage,"showQAInfo"),this.bindEvent("#inputCancel","tap",this.page.userInputPage,"cancel"),this.bindEvent("#inputSubmit","tap",this.page.userInputPage,"submit"),this.bindEvent("#imgBack","tap",this,"showPage","userHomePage"),this.bindEvent("#setHead","tap",this.user,"setHead"),this.bindEvent("#deleteHead","tap",this.user,"deleteHead"),this.bindEvent("#finishInfoButton","tap",this,"showPage","userHomePage"),this.bindEvent("#activateButton","tap",this,"activate"),this.bindEvent("#matchMateAvatar","tap",this,"enterMateHome"),this.bindEvent("#matchControlLeftButton","tap",this.mate,"controlLeft"),this.bindEvent("#matchControlRightButton","tap",this.mate,"controlRight"),this.bindEvent("#matePersonalInfoNav","tap",this.page.mateHomePage,"showPersonalInfo"),this.bindEvent("#mateMatchInfoNav","tap",this.page.mateHomePage,"showMatchInfo"),this.bindEvent("#mateQAInfoNav","tap",this.page.mateHomePage,"showQAInfo"),this.bindEvent("#nextAnswerNav","tap",this.page.mateHomePage,"showNextAnswer"),this.bindEvent("#lastAnswerNav","tap",this.page.mateHomePage,"showLastAnswer"),this.bindEvent("#seeLifeNav","tap",this,"showPage","userSeeLifeTestPage"),this.bindEvent("#personalityNav","tap",this,"showPage","userPersonalityTestPage"),this.bindEvent("#seeLoveNav","tap",this,"showPage","userSeeLoveTestPage"),this.bindEvent("#communicationNav","tap",this,"showPage","userCommunicationTestPage"),this.bindEvent(".userInfoItem","tap",this.page.userInputPage,"showInput"),this.bindEvent("#talkSubmit","tap",this.tcp,"sendMessage"),this.bindEvent("#userImgSwipe","tap",this.user,"showImgHeader"),this.bindEvent("#mateImgSwipe","tap",this,"pageBack"),this.bindEvent("#userHomeHead","tap",this,"pageBack"),this.bindEvent("#mateHomeHead","tap",this,"pageBack"),jQuery(":text").bind("focus",function(){pie.inputFocus(this)}),jQuery(":password").bind("focus",function(){pie.inputFocus(this)}),jQuery("textarea").bind("focus",function(){pie.inputFocus(this)}),jQuery(":text").bind("blur",function(){pie.inputBlur(this)}),jQuery(":password").bind("blur",function(){pie.inputBlur(this)}),jQuery("textarea").bind("blur",function(){pie.inputBlur(this)}),jQuery("#talkForm").submit(function(){return pie.tcp.sendMessage()})},bindEvent:function(e,t,n,r,i){Quo(e).bind(t,function(){i!=undefined?n[r](i,this.id):n[r](this.id)})},talkInputBlur:function(){jQuery("#talkInput").blur()},matchStudy:function(){if(pie.mate.exist)return;this.studyStart?(this.studyStart=!1,jQuery("#pieMatchIndexPageMenu").html("体验一下"),jQuery("#matchStatus").css("-webkit-transition","500ms"),jQuery("#matchStatus").css("-webkit-transform","translate3d(0,0,0)")):(this.studyStart=!0,jQuery("#pieMatchIndexPageMenu").html("体验中"),jQuery("#matchStatus").css("-webkit-transition","1000ms"),jQuery("#matchStatus").css("-webkit-transform","translate3d(0,-"+2*(pie.height-pie.headerHeight)+"px,0)"))},showPage:function(e){this.expand();if(this.curPageId==e)return;jQuery("#"+this.curPageId+"Menu").css("display","none"),jQuery("#"+e+"Menu").css("display","block"),jQuery("#"+this.curPageId).css("display","none");if(e=="pieMatchIndexPage"&&this.matchIndexReduce==1){this.enterMatchIndex();return}jQuery("#"+e).css("display","block");switch(this.curPageId){case"userShowImgPage":case"mateShowImgPage":case"pieGuidePage":this.swipePhoto=!1}this.curPageId=e;var t=!1;switch(e){case"userHomePage":t=!0,jQuery(".menuNavOuter").css("background-color","transparent"),jQuery("#menuUserHomeNav").css("background-color","#525252");break;case"pieMatchIndexPage":t=!0,jQuery(".menuNavOuter").css("background-color","transparent"),jQuery("#menuPieMatchNav").css("background-color","#525252");break;case"pieSettingPage":t=!0,jQuery(".menuNavOuter").css("background-color","transparent"),jQuery("#menuPieSettingNav").css("background-color","#525252");break;case"pieTestIndexPage":t=!0,jQuery(".menuNavOuter").css("background-color","transparent"),jQuery("#menuPieTestNav").css("background-color","#525252");break;case"mateTalkPage":pie.remind("请不要输入黄色暴力信息!"),pie.tcp.clearUnreadMessage();var n=jQuery("#talkInputArea").prop("offsetHeight");jQuery("#talkRecordArea").css("height",this.height-n-44),this.talkScrollArea.refresh();var r=pie.user.talkRecord;for(var i=0;i<r.length;i++)r[i].status==pie.messageStatus.sendFailed&&(jQuery("#"+i+"userTalkBlock .userTalkContent").data("id",i),jQuery("#"+i+"userTalkBlock .userTalkContent").css("background-color","#555"),Quo(".userTalkContent").unbind("hold"),Quo(".userTalkContent").bind("hold",function(){var e=jQuery(this).data("id");if(!e||e<0)return;pie.tcp.showMessageControl(e)}));break;case"userShowImgPage":case"mateShowImgPage":case"pieGuidePage":pie.swipePhoto=!0}t?(jQuery("#birdBack").css("display","block"),jQuery("#arrowBack").css("display","none")):(jQuery("#arrowBack").css("display","block")
,jQuery("#birdBack").css("display","none"));var s=pie.page[e];s.title?(jQuery("#pieHeader").css("display","block"),jQuery("#pageTitle").html(pie.page[e].title),jQuery("#"+e).css("height",pie.height-pie.headerHeight)):(jQuery("#pieHeader").css("display","none"),jQuery("#"+e).css("height",pie.height)),s.needScroll&&(s.scrollArea?s.scrollArea.refresh():s.needRefresh?s.scrollArea=new iScroll(e,{useTransition:!0,topOffset:50,hScroll:!1,checkDOMChanges:!1,onScrollMove:function(){this.y>5&&pie.refreshReady?(jQuery("#"+pie.curPageId+" .refreshIcon i").css("-webkit-transform","rotate(180deg)"),jQuery("#"+pie.curPageId+" .refreshText").html("松开即可刷新"),this.minScrollY=0):this.y<5&&!pie.refreshReady&&(pie.refreshReady=!0,jQuery("#"+pie.curPageId+" .refreshText").html("下拉可以刷新"),this.minScrollY=-50)},onScrollEnd:function(){pie.refreshReady&&(jQuery("#"+pie.curPageId+" .refreshText").html("正在刷新"),pie.startRefresh())}}):s.scrollArea=new iScroll(e,{useTransition:!0,hScroll:!1,checkDOMChanges:!1})),s.init(1)},enterMateHome:function(){jQuery("#mateHomePage").css("display","block"),jQuery("#pieMatchIndexPageMenu").css("display","none"),jQuery("#mateHomePageMenu").css("display","block"),jQuery("#pageTitle").html(pie.page.mateHomePage.title),jQuery("#arrowBack").css("display","block"),jQuery("#birdBack").css("display","none"),jQuery("#pieMatchIndexPage").css("-webkit-transform","scale(0.2)"),jQuery("#pieMatchIndexPage").css("opacity","0"),setTimeout(function(){pie.showPage("mateHomePage")},700),this.matchIndexReduce=!0},enterMatchIndex:function(){jQuery("#pieMatchIndexPage").css("display","block"),jQuery("#pieMatchIndexPageMenu").css("display","block"),jQuery("#mateHomePageMenu").css("display","none"),jQuery("#pageTitle").html("PieMoment"),jQuery("#arrowBack").css("display","none"),jQuery("#birdBack").css("display","block"),jQuery(".menuNavOuter").css("background-color","transparent"),jQuery("#menuPieMatchNav").css("background-color","#525252"),this.curPageId="pieMatchIndexPage",setTimeout(function(){jQuery("#pieMatchIndexPage").css("-webkit-transform","scale(1)"),jQuery("#pieMatchIndexPage").css("opacity","1")},0),setTimeout(function(){jQuery("#mateHomePage").css("display","none")},800),this.matchIndexReduce=!1},pageBack:function(){if(this.leftMenu.display||this.rightMenu.display){this.expand();return}if(this.loadingShow){this.hideLoading();return}if(this.confirmShow)return;var e=this.page[this.curPageId].backPageId;e?this.curPageId!="mateHomePage"?this.showPage(e):this.enterMatchIndex():this.showLeftMenu()},askQuestion:function(){this.expand(),setTimeout(function(){pie.page.userInputPage.showInput("askQuestion")},300)},activate:function(){var e={token:pie.user.data.access_token};pie.showLoading("正在激活"),jQuery.ajax({url:pie.serverBase+"/api/rest/apps/pie_match/activate.json",type:"get",data:e,dataType:"json",success:function(e){pie.hideLoading();if(e.status!="success"){e.code=="2002"?pie.confirm("账号已过期,请重新登录",function(){pie.user.logout(0)},!1):pie.remind("激活账号失败,错误码:"+e.code+"请报告管理员");return}pie.page.pieMatchIndexPage.inited=!1,pie.page.pieMatchIndexPage.init(1)},error:function(e){pie.hideLoading(),pie.remind("激活账号失败:"+e+",这应该是网络问题造成的")}})},startRefresh:function(){pie.refreshStart=!0,pie.page[pie.curPageId].needRefresh&&(jQuery("#"+pie.curPageId+" .refreshIcon i").removeClass("icon-arrow-down"),jQuery("#"+pie.curPageId+" .refreshIcon i").addClass("icon-spin icon-spinner"),pie.page[pie.curPageId].inited=!1,pie.page[pie.curPageId].init(0))},endRefresh:function(){pie.refreshStart=!1,pie.refreshReady=!1;var e=new Date,t=e.getMonth()+1;t<10&&(t="0"+t);var n=e.getDate();n<10&&(n="0"+n);var r=e.getHours();r<10&&(r="0"+r);var i=e.getMinutes();i<10&&(i="0"+i);var s="更新于: "+t+"-"+n+" "+r+":"+i;jQuery("#"+pie.curPageId+" .refreshIcon i").removeClass("icon-spin icon-spinner"),jQuery("#"+pie.curPageId+" .refreshIcon i").addClass("icon-arrow-down"),jQuery("#"+pie.curPageId+" .refreshIcon i").css("-webkit-transform","rotate(0deg)"),jQuery("#"+pie.curPageId+" .refreshText").html("刷新成功"),jQuery("#"+pie.curPageId+" .refreshTime").html(s),setTimeout(function(){pie.page[pie.curPageId].scrollArea.refresh()},100)},messageTime:function(){var e=new Date,t=e.getFullYear(),n=e.getMonth()+1;n<10&&(n="0"+n);var r=e.getDate();r<10&&(r="0"+r);var i=e.getHours();i<10&&(i="0"+i);var s=e.getMinutes();s<10&&(s="0"+s);var o=e.getSeconds();o<10&&(o="0"+o);var u=t+"-"+n+"-"+r+" "+i+":"+s+":"+o;return u},expand:function(){pie.leftMenu.display?pie.expandLeft():pie.rightMenu.display&&pie.expandRight()},reduceLeft:function(){pie.rightMenu.show(),this.isOld?(jQuery("#pie").removeClass("expandLeftOld expandRightOld reduceLeftOld reduceRightOld"),jQuery("#pie").addClass("reduceLeftOld")):(jQuery("#pie").removeClass("expandLeftApp expandRightApp reduceLeftApp reduceRightApp"),jQuery("#pie").addClass("reduceLeftApp")),setTimeout(function(){jQuery("#pieRightMenu .container").css("-webkit-transform","scale(1)")},0)},expandRight:function(){jQuery("#pieRightMenu .container").css("-webkit-transform","scale(0.5)"),setTimeout(function(){pie.isOld?(jQuery("#pie").removeClass("expandLeftOld expandRightOld reduceLeftOld reduceRightOld"),jQuery("#pie").addClass("expandRightOld")):(jQuery("#pie").removeClass("expandLeftApp expandRightApp reduceLeftApp reduceRightApp"),jQuery("#pie").addClass("expandRightApp")),setTimeout(function(){pie.rightMenu.hide()},500)},0)},reduceRight:function(){pie.leftMenu.show(),this.isOld?(jQuery("#pie").removeClass("expandLeftOld expandRightOld reduceLeftOld reduceRightOld"),jQuery("#pie").addClass("reduceRightOld")):(jQuery("#pie").removeClass("expandLeftApp expandRightApp reduceLeftApp reduceRightApp"),jQuery("#pie").addClass("reduceRightApp")),setTimeout(function(){jQuery("#pieLeftMenu .container").css("-webkit-transform","scale(1)")},0)},expandLeft:function(){jQuery("#pieLeftMenu .container").css("-webkit-transform","scale(0.5)"),setTimeout(function(){pie.isOld?(jQuery("#pie").removeClass("expandLeftOld expandRightOld reduceLeftOld reduceRightOld"),jQuery("#pie").addClass("expandLeftOld")):(jQuery("#pie").removeClass("expandLeftApp expandRightApp reduceLeftApp reduceRightApp"),jQuery("#pie").addClass("expandLeftApp")),setTimeout(function(){pie.leftMenu.hide()},500)},0)},showLeftMenu:function(e){var t=e||window.event;t.stopPropagation(),this.reduceRight()},inputFocus:function(e){if(this.onInput)return;this.curInputId=e.id,this.onInput=!0},inputBlur:function(){this.onInput=!1,this.curInputId=null,jQuery("#pie").css("top",0)},backup:function(){for(var e in pie.pieMoment.users[pie.pieMoment.userId])pie.pieMoment.users[pie.pieMoment.userId][e]=pie.user[e];window.localStorage.pieMoment=JSON.stringify(pie.pieMoment)},getLocalData:function(){this.user.exist=!0;for(var e in pie.pieMoment.users[pie.pieMoment.userId])pie.user[e]=pie.pieMoment.users[pie.pieMoment.userId][e];pie.user.autoLogin()},clearLocalData:function(){delete window.localStorage.pieMoment,window.location.reload()},startCountDown:function(){this.countDownInterval=setInterval(this.countDown,1e3),jQuery("#countDownTime").css("display","inline")},countDown:function(){var e=new Date,t=e.getHours(),n=e.getMinutes(),r=e.getSeconds();t>=pie.refreshTime&&!pie.autoRefresh&&pie.user.infoFinished&&(pie.page.pieMatchIndexPage.inited=!1,pie.page.pieMatchIndexPage.init(1));var i,s,o;t<12?i=11-t:i=35-t,i<10&&(i="0"+i),s=59-n,s<10&&(s="0"+s),o=59-r,o<10&&(o="0"+o),jQuery("#countDownTime").html(i+":"+s+":"+o),jQuery("#statusTime").html(i+":"+s+":"+o)},resendSecurityCode:function(){pie.showLoading("正在获取激活码");var e={app_token:"app_token",_format:"json",type:1,mobile_phone:this.curLoginAccount,email:this.curLoginAccount};jQuery.ajax({url:pie.serverBase+"/api/auth/account/register/via/mobile/phone",type:"post",data:e,dataType:"json",success:function(e){pie.hideLoading(),e.status=="success"?(pie.remind("激活码已发至您的手机,请查看"),jQuery("#pieActivateInput").focus()):pie.remind("注册未知错误:"+e.message)},error:function(e){pie.hideLoading(),pie.remind("激活码发送失败:"+e+",这应该是网络问题造成的")}})},ratingAnimate:function(e){var t=100,n=["bd2c33","e49420","ecdb00","3bad54","1b7db9"],r=function(r){jQuery("#"+e+"Rating li a").each(function(){jQuery(this).parent().index()<=r&&jQuery(this).stop().animate({backgroundColor:"#"+n[r]},t)})},i="ontouchstart"in window;i?(jQuery("#"+e+"Rating li a").unbind("touchstart"),jQuery("#"+e+"Rating li a").bind("touchstart",function(){r(jQuery(this).parent().index())}),jQuery("#"+e+"Rating li a").unbind("touchend"),jQuery("#"+e+"Rating li a").bind("touchend",function(){jQuery("#"+e+"Rating li a").stop().animate({backgroundColor:"#fcb0cd"},t)})):jQuery("#"+e+"Rating li a").hover(function(){r(jQuery(this).parent().index())},function(){jQuery("#"+e+"Rating li a").stop().animate({backgroundColor:"#fcb0cd"},t)}),Quo("#"+e+"Rating li a").unbind("tap"),Quo("#"+e+"Rating li a").bind("tap",function(e){pie.page[pie.curPageId].submit(jQuery(this).parent().index())})},countConstellation:function(e){for(var t in e)e[t]=parseInt(e[t]);var n=[1.01,1.21,2.19,3.21,4.21,5.21,6.22,7.23,8.23,9.23,10.23,11.22,12.22],r=["魔羯座","水瓶座","双鱼座","白羊座","金牛座","双子座","巨蟹座","狮子座","处女座","天秤座","天蝎座","射手座","魔羯座"],i=(e[1]+e[2]/100).toFixed(2),s="error";for(var o=0;o<13;o++){var u=(o+1)%13;if(n[u]>=i){s=r[o];break}}return s},showShadow:function(){pie.swipePhoto=!0,jQuery("#pieShadow").css("display","block")},hideShadow:function(){this.curPageId!="userShowImgPage"&&this.curPageId!="mateShowImgPage"&&this.curPageId!="pieGuidePage"&&(pie.swipePhoto=!1),jQuery("#pieShadow").css("display","none")},showLoading:function(e){this.showShadow(),this.loadingShow=!0,jQuery("#pieLoading").css("top",Math.floor((pie.height-102)/2)),jQuery("#loadingInfo").html(e),jQuery("#pieLoading").css("display","block"),clearTimeout(this.loading),this.loading=setTimeout(function(){pie.hideLoading(),pie.remind("加载失败,网络不给力啊...")},3e4)},hideLoading:function(){this.hideShadow(),clearTimeout(this.loading),this.loadingShow=!1,jQuery("#pieLoading").css("display","none")},upload:function(e){function s(e){pie.hideLoading();var t=JSON.parse(e.response);t.status=="success"?pie.user.getInfo(0):pie.remind("上传文件失败,原因可能是:"+t.message)}function o(e){pie.hideLoading(),pie.remind("上传文件失败,这应该是网络问题造成的")}pie.showLoading("正在上传");var t=new FileTransfer,n=new FileUploadOptions;n.fileKey="file",n.fileName=e.substr(e.lastIndexOf("/")+1),n.mimeType="image/jpeg";var r={};r.token=pie.user.data.access_token,n.params=r;var i=pie.serverBase+"/api/rest/users/"+pie.user.data.puid+"/photos.json";t.upload(e,i,s,o,n)},uploadVideo:function(e){function s(e){pie.hideLoading(),e.status=="success"?pie.remind("上传视频成功"):pie.remind("上传视频失败")}function o(e){pie.hideLoading(),pie.remind("上传文件失败,这应该是网络问题造成的")}pie.showLoading("正在上传");var t=new FileTransfer,n=new FileUploadOptions;n.fileKey="file",n.fileName=e.substr(e.lastIndexOf("/")+1),n.mimeType="video/mp4";var r={};r.puid=pie.user.data.puid,n.params=r;var i=pie.gameBase+"/upload";t.upload(e,i,s,o,n)},uploadPhotoSelect:function(e){var t=e.value;jQuery("#uploadPhotoSelect").val(-1),t==0?this.getPicture(Camera.SAVEDPHOTOALBUM):this.getPicture(Camera.PictureSourceType.PHOTOLIBRARY)},getPicture:function(e){function t(e){jQuery("#uploadPhotoSelect").val(-1),pie.upload(e),navigator.camera.cleanup()}function n(e){jQuery("#uploadPhotoSelect").val(-1)}navigator.camera.getPicture(t,n,{quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:e,correctOrientation:!0})},startRecord:function(){var e=document.getElementById("userVideo");navigator.device.capture.captureVideo(function(t){var n=t[0].fullPath;e.src=n,pie.uploadVideo(n)},function(e){},null)},remind:function(e){var t="pieRemind";jQuery("#"+t+" td").html(e),jQuery("#"+t).css("display","block"),this.remindDisapear&&clearTimeout(this.remindDisapear),this.remindDisapear=setTimeout(function(){jQuery("#"+t).fadeOut(2500)},1e3)},confirm:function(e,t){var n=jQuery("#pieConfirm").height()+100;jQuery("#pieConfirm").css("top",Math.floor((pie.height-n)/2)),this.showShadow(),this.confirmShow=!0,jQuery("#pieConfirm").css("display","block"),jQuery("#confirmContent").html(e),Quo("#confirmYes").unbind("tap"),Quo("#confirmYes").bind("tap",function(){pie.hideConfirm(),t()})},hideConfirm:function(){pie.confirmShow=!1,pie.hideShadow(),jQuery("#pieConfirm").css("display","none")}};$(document).ready(init)